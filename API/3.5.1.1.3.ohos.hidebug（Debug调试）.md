# ohos.hidebug（Debug调试）

使用hidebug，可以获取应用内存的使用情况，包括应用进程的静态堆内存（native heap）信息、应用进程内存占用PSS（Proportional Set Size）信息等。

```cangjie
import kit.PerformanceAnalysisKit.*
```
## Functions

### public func getAppMemoryLimit(): MemoryLimit

```cangjie
public func getAppMemoryLimit(): MemoryLimit
```
功能： 获取应用程序进程内存限制。

**Returns:**

| type | description |
| --- | --- |
| MemoryLimit | 应用程序进程内存限制。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let appMemoryLimit: MemoryLimit = getAppMemoryLimit()
```

### public func getAppNativeMemInfo(): NativeMemInfo

```cangjie
public func getAppNativeMemInfo(): NativeMemInfo
```
功能： 获取应用进程内存信息。

**Returns:**

| type | description |
| --- | --- |
| NativeMemInfo | 应用进程内存信息。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let nativeMemInfo: NativeMemInfo = getAppNativeMemInfo()
```

### public func getAppThreadCpuUsage(): Array<ThreadCpuUsage>

```cangjie
public func getAppThreadCpuUsage(): Array<ThreadCpuUsage>
```
功能： 获取应用线程CPU使用情况。

**Returns:**

| type | description |
| --- | --- |
| Array< ThreadCpuUsage > | 返回当前应用进程下所有 ThreadCpuUsage 数组。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let appThreadCpuUsage: Array<ThreadCpuUsage> = getAppThreadCpuUsage()
```

### public func getCpuUsage(): Float64

```cangjie
public func getCpuUsage(): Float64
```
功能： 获取进程的CPU使用率。

**Returns:**

| type | description |
| --- | --- |
| Float64 | 获取进程的CPU使用率。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let cpuUsage: Float64 = getCpuUsage()
```

### public func getNativeHeapAllocatedSize(): UInt64

```cangjie
public func getNativeHeapAllocatedSize(): UInt64
```
功能： 获取内存分配器统计的进程业务分配的堆内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回内存分配器统计的进程业务分配的堆内存大小，单位为Byte。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let nativeHeapAllocatedSize: UInt64 = getNativeHeapAllocatedSize()
```

### public func getNativeHeapFreeSize(): UInt64

```cangjie
public func getNativeHeapFreeSize(): UInt64
```
功能： 获取内存分配器持有的缓存内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回内存分配器持有的缓存内存大小，单位为Byte。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let nativeHeapFreeSize: UInt64 = getNativeHeapFreeSize()
```

### public func getNativeHeapSize(): UInt64

```cangjie
public func getNativeHeapSize(): UInt64
```
功能： 获取内存分配器统计的进程持有的堆内存大小（含分配器元数据）。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 内存分配器统计的进程持有的堆内存大小（含分配器元数据），单位为Byte。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let nativeHeapSize: UInt64 = getNativeHeapSize()
```

### public func getPrivateDirty(): UInt64

```cangjie
public func getPrivateDirty(): UInt64
```
功能： 获取进程的私有脏内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回进程的私有脏内存大小，单位为kB。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let privateDirty: UInt64 = getPrivateDirty()
```

### public func getPss(): UInt64

```cangjie
public func getPss(): UInt64
```
功能： 获取应用进程实际使用的物理内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回应用进程实际使用的物理内存大小，单位为kB。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let pss: UInt64 = getPss()
```

### public func getServiceDump(serviceid: Int32, fd: Int32, args: Array<String>): Unit

```cangjie
public func getServiceDump(serviceid: Int32, fd: Int32, args: Array<String>): Unit
```
功能： 获取系统服务信息。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 基于该用户输入的service id获取系统服务信息。 | serviceid | - |
| Int32 | 是 | 文件描述符，该接口会往该fd中写入数据。 | fd | - |
| Array<String> | 是 | 系统服务的Dump接口所对应的参数列表。 | args | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 Hidebug错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | the parameter check failed, Possible causes:1.the parameter type error 2.the args parameter is not String array. |
| 11400101 | ServiceId invalid. The system ability does not exist. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*
import ohos.base.AppLog
import kit.CoreFileKit.*

let file = FileFs.open("/data/storage/el1/base/testfile", mode: OpenMode.READ_WRITE.mode | OpenMode.CREATE.mode)
try {
 getServiceDump(10, file.fd, ["allInfo"])
} catch (e: Exception) {
 AppLog.error("${e}")
}
FileFs.close(file)
```

### public func getSharedDirty(): UInt64

```cangjie
public func getSharedDirty(): UInt64
```
功能： 获取进程的共享脏内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回进程的共享脏内存大小，单位为kB。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let sharedDirty: UInt64 = getSharedDirty()
```

### public func getSystemCpuUsage(): Float64

```cangjie
public func getSystemCpuUsage(): Float64
```
功能： 获取系统的CPU资源占用情况。

**Returns:**

| type | description |
| --- | --- |
| Float64 | 系统CPU资源占用情况。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 Hidebug CpuUsage错误码 。

| code | description |
| --- | --- |
| 11400104 | The status of the system CPU usage is abnormal. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let cpuUsage: Float64 = getSystemCpuUsage()
```

### public func getSystemMemInfo(): SystemMemInfo

```cangjie
public func getSystemMemInfo(): SystemMemInfo
```
功能： 获取系统内存信息。

**Returns:**

| type | description |
| --- | --- |
| SystemMemInfo | 系统内存信息。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let systemMemInfo: SystemMemInfo = getSystemMemInfo()
```

### public func getVss(): UInt64

```cangjie
public func getVss(): UInt64
```
功能： 获取应用进程虚拟耗用内存大小。

**Returns:**

| type | description |
| --- | --- |
| UInt64 | 返回应用进程虚拟耗用内存大小，单位为kB。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let vss: UInt64 = getVss()
```

### public func isDebugState(): Bool

```cangjie
public func isDebugState(): Bool
```
功能： 获取应用进程被调试状态，如果应用进程的native层处于被调试状态，则返回true，否则返回false。暂不支持仓颉层。

**Returns:**

| type | description |
| --- | --- |
| Bool | 应用进程被调试状态。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let debugState: Bool = isDebugState()
```

### public func setAppResourceLimit(resType: String, value: Int32, enableDebugLog: Bool): Unit

```cangjie
public func setAppResourceLimit(resType: String, value: Int32, enableDebugLog: Bool): Unit
```
功能： 设置应用的fd数量、线程数量或者native内存资源限制。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| String | 是 | 泄漏资源类型，共三种类型:pss_memory(native内存)、fd(文件描述符)或thread(线程)。 | resType | - |
| Int32 | 是 | 对应泄漏资源类型的最大值。范围：pss_memory类型 [1024, 4 * 1024 * 1024](单位：KB) ， fd类型 [10, 10000] ， thread类型 [1, 1000] 。 | value | - |
| Bool | 是 | 是否启用外部调试日志，默认值为false，请仅在灰度版本中设置为true，因为收集调试日志会花费太多的cpu或内存。 | enableDebugLog | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 Hidebug错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | Invalid argument, Possible causes:1.The limit parameter is too small 2.The parameter is not in the specified type 3.The parameter type error or parameter order error. |
| 11400104 | Set limit failed due to remote exception. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

setAppResourceLimit("fd", 85, false)
```

### public func startAppTraceCapture(tags: Array<UInt64>, flag: TraceFlag, limitSize: UInt32): String

```cangjie
public func startAppTraceCapture(tags: Array<UInt64>, flag: TraceFlag, limitSize: UInt32): String
```
功能： 启动应用trace采集， startAppTraceCapture 方法的调用需要与 stopAppTraceCapture 方法的调用一一对应。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Array<UInt64> | 是 | 详情请见 Tags 。 | tags | - |
| TraceFlag | 是 | 详情请见 TraceFlag 。 | flag | - |
| UInt32 | 是 | 开启trace文件大小限制，单位为Byte，单个文件大小上限为500MB。 | limitSize | - |

**Returns:**

| type | description |
| --- | --- |
| String | 返回trace文件名路径。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 Hidebug错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | Invalid argument, Possible causes:1.The limit parameter is too small 2.The parameter is not within the enumeration type 3.The parameter type error or parameter order error. |
| 11400102 | Capture trace already enabled. |
| 11400103 | No write permission on the file. |
| 11400104 | Abnormal trace status. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let fileName: String = startAppTraceCapture([Tags.ABILITY_MANAGER, Tags.ARKUI], MAIN_THREAD, 1024*1204)
// code block
// ...
// code block
stopAppTraceCapture()
```

### public func stopAppTraceCapture(): Unit

```cangjie
public func stopAppTraceCapture(): Unit
```
功能： 停止应用trace采集，在停止采集前，需要通过 startAppTraceCapture 方法开始采集。

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 Hidebug错误码 。

| code | description |
| --- | --- |
| 11400104 | The status of the trace is abnormal. |
| 11400105 | No capture trace running. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.PerformanceAnalysisKit.*

let fileName: String = startAppTraceCapture([Tags.ABILITY_MANAGER, Tags.ARKUI], MAIN_THREAD, 1024*1204)
// code block
// ...
// code block
stopAppTraceCapture()
```


## Classes

### MemoryLimit

class MemoryLimit
```cangjie
public class MemoryLimit { public let rssLimit: UInt64 public let vssLimit: UInt64 }
```
功能： 应用程序进程内存限制。

#### let rssLimit

```cangjie
public let rssLimit: UInt64
```
功能： 应用程序进程的驻留集的限制，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let vssLimit

```cangjie
public let vssLimit: UInt64
```
功能： 进程的虚拟内存限制，以KB为单位。
Type: UInt64; Readable: true; Writable: false


### NativeMemInfo

class NativeMemInfo
```cangjie
public class NativeMemInfo { public let privateClean: UInt64 public let privateDirty: UInt64 public let pss: UInt64 public let rss: UInt64 public let sharedClean: UInt64 public let sharedDirty: UInt64 public let vss: UInt64 }
```
功能： 描述应用进程内存信息。

#### let privateClean

```cangjie
public let privateClean: UInt64
```
功能： 专用干净内存的大小，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let privateDirty

```cangjie
public let privateDirty: UInt64
```
功能： 专用脏内存的大小，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let pss

```cangjie
public let pss: UInt64
```
功能： 实际占用的物理内存的大小(比例分配共享库占用的内存)，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let rss

```cangjie
public let rss: UInt64
```
功能： 实际占用的物理内存的大小(包括共享库占用)，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let sharedClean

```cangjie
public let sharedClean: UInt64
```
功能： 共享干净内存的大小，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let sharedDirty

```cangjie
public let sharedDirty: UInt64
```
功能： 共享脏内存的大小，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let vss

```cangjie
public let vss: UInt64
```
功能： 占用虚拟内存大小(包括共享库所占用的内存)，以KB为单位。
Type: UInt64; Readable: true; Writable: false


### SystemMemInfo

class SystemMemInfo
```cangjie
public class SystemMemInfo { public let availableMem: UInt64 public let freeMem: UInt64 public let totalMem: UInt64 }
```
功能： 描述系统内存信息。

#### let availableMem

```cangjie
public let availableMem: UInt64
```
功能： 系统可用的内存，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let freeMem

```cangjie
public let freeMem: UInt64
```
功能： 系统空闲的内存，以KB为单位。
Type: UInt64; Readable: true; Writable: false

#### let totalMem

```cangjie
public let totalMem: UInt64
```
功能： 系统总的内存，以KB为单位。
Type: UInt64; Readable: true; Writable: false


### Tags

class Tags
```cangjie
public class Tags { public static const ABILITY_MANAGER: UInt64 = 1 << 31 public static const ARKUI: UInt64 = 1 << 39 public static const ARK: UInt64 = 1 << 47 public static const BLUETOOTH: UInt64 = 1 << 60 public static const COMMON_LIBRARY: UInt64 = 1 << 16 public static const DISTRIBUTED_HARDWARE_DEVICE_MANAGER: UInt64 = 1 << 54 public static const DISTRIBUTED_AUDIO: UInt64 = 1 << 27 public static const DISTRIBUTED_CAMERA: UInt64 = 1 << 51 public static const DISTRIBUTED_DATA: UInt64 = 1 << 36 public static const DISTRIBUTED_HARDWARE_FRAMEWORK: UInt64 = 1 << 52 public static const DISTRIBUTED_INPUT: UInt64 = 1 << 59 public static const DISTRIBUTED_SCREEN: UInt64 = 1 << 50 public static const DISTRIBUTED_SCHEDULER: UInt64 = 1 << 57 public static const FFRT: UInt64 = 1 << 13 public static const FILE_MANAGEMENT: UInt64 = 1 << 29 public static const GLOBAL_RESOURCE_MANAGER: UInt64 = 1 << 53 public static const GRAPHICS: UInt64 = 1 << 38 public static const HDF: UInt64 = 1 << 18 public static const MISC: UInt64 = 1 << 41 public static const MULTIMODAL_INPUT: UInt64 = 1 << 42 public static const NET: UInt64 = 1 << 23 public static const NOTIFICATION: UInt64 = 1 << 40 public static const NWEB: UInt64 = 1 << 24 public static const OHOS: UInt64 = 1 << 30 public static const POWER_MANAGER: UInt64 = 1 << 56 public static const RPC: UInt64 = 1 << 46 public static const SAMGR: UInt64 = 1 << 55 public static const WINDOW_MANAGER: UInt64 = 1 << 48 public static const AUDIO: UInt64 = 1 << 35 public static const CAMERA: UInt64 = 1 << 32 public static const IMAGE: UInt64 = 1 << 34 public static const MEDIA: UInt64 = 1 << 33 }
```
功能： 描述支持/使用场景标签。


### ThreadCpuUsage

class ThreadCpuUsage
```cangjie
public class ThreadCpuUsage {}
```
功能： 描述线程CPU使用情况。

#### let cpuUsage

```cangjie
public let cpuUsage: Float64
```
功能： 线程CPU使用率。
Type: Float64; Readable: true; Writable: false

#### let threadId

```cangjie
public let threadId: UInt32
```
功能： 线程号。
Type: UInt32; Readable: true; Writable: false



## Enums

### TraceFlag

enum TraceFlag
```cangjie
public enum TraceFlag { | MAIN_THREAD | ALL_THREADS | ... }
```
功能： 描述采集trace线程的类型。

#### ALL_THREADS

```cangjie
ALL_THREADS
```
功能： 采集当前应用下所有线程。

#### MAIN_THREAD

```cangjie
MAIN_THREAD
```
功能： 只采集当前应用主线程。



