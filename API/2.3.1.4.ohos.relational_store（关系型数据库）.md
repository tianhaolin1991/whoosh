# ohos.relational_store（关系型数据库）

关系型数据库（Relational Database，RDB）是一种基于关系模型来管理数据的数据库。关系型数据库基于SQLite组件提供了一套完整的对本地数据库进行管理的机制，对外提供了一系列的增、删、改、查等接口，也可以直接运行用户输入的SQL语句来满足复杂的场景需要。不支持Worker线程。

```cangjie
import kit.ArkData.*
```
## Functions

### public func deleteRdbStore(context: StageContext, name: String): Unit

```cangjie
public func deleteRdbStore(context: StageContext, name: String): Unit
```
功能： 使用指定的数据库文件配置删除数据库。删除成功后，建议将数据库对象置为None。建立数据库时，若在 StoreConfig 中配置了自定义路径，则调用此接口进行删库无效，必须使用 deleteRdbStore(StageContext, StoreConfig) 接口进行删库。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| StageContext | 是 | 应用的上下文。context的获取方式请参见 getStageContext 。 | context | - |
| String | 是 | 数据库名称。 | name | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 关系型数据库错误码 。

| code | description |
| --- | --- |
| 401 | Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types. |
| 14800000 | Inner error. |
| 14800010 | Invalid database path. |
| 14800011 | Database corrupted. |
| 14800017 | Config changed. |
| 14800021 | SQLite: Generic error. |
| 14800027 | SQLite: Attempt to write a readonly database. |
| 14800028 | SQLite: Some kind of disk I/O error occurred. |
| 14800029 | SQLite: The database is full. |
| 14800030 | SQLite: Unable to open the database file. |
| 14801001 | Only supported in stage mode. |
| 14801002 | The data group id is not valid. |


**Example:**

```cangjie
// index.cj

import kit.ArkData.*

var rdbStore: RdbStore = getRdbStore(Global.getStageContext(), StoreConfig("RdbTest.db", RelationalStoreSecurityLevel.S1)) // 需获取Context应用上下文，详见本文使用说明
deleteRdbStore(Global.getStageContext(), "RdbTest.db")
```

### public func deleteRdbStore(context: StageContext, config: StoreConfig): Unit

```cangjie
public func deleteRdbStore(context: StageContext, config: StoreConfig): Unit
```
功能： 使用指定的数据库文件配置删除数据库。删除成功后，建议将数据库对象置为None。若数据库文件处于公共沙箱目录下，则删除数据库时必须使用该接口，当存在多个进程操作同一个数据库的情况，建议向其他进程发送数据库删除通知使其感知并处理。建立数据库时，若在 StoreConfig 中配置了自定义路径，则必须调用此接口进行删库。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| StageContext | 是 | 应用的上下文。context的获取方式请参见 getStageContext 。 | context | - |
| StoreConfig | 是 | 与此RDB存储相关的数据库配置。 | config | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 关系型数据库错误码 。

| code | description |
| --- | --- |
| 401 | Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types. |
| 14800000 | Inner error. |
| 14800010 | Invalid database path. |
| 14801001 | Only supported in stage mode. |
| 14801002 | The data group id is not valid. |


**Example:**

```cangjie
// index.cj

import kit.ArkData.*

var rdbStore: RdbStore = getRdbStore(Global.getStageContext(), StoreConfig("RdbTest.db", RelationalStoreSecurityLevel.S1)) // 需获取Context应用上下文，详见本文使用说明
deleteRdbStore(Global.getStageContext(), StoreConfig("RdbTest.db", RelationalStoreSecurityLevel.S1))
```

### public func getRdbStore(context: StageContext, config: StoreConfig): RdbStore

```cangjie
public func getRdbStore(context: StageContext, config: StoreConfig): RdbStore
```
功能： 获得一个相关的RdbStore，操作关系型数据库，用户可以根据自己的需求配置RdbStore的参数，然后调用RdbStore接口执行相关的数据操作。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| StageContext | 是 | 应用的上下文。context的获取方式请参见 getStageContext 。 | context | - |
| StoreConfig | 是 | 与此RDB存储相关的数据库配置。 | config | - |

**Returns:**

| type | description |
| --- | --- |
| RdbStore | 返回RdbStore对象。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 关系型数据库错误码 。

| code | description |
| --- | --- |
| 401 | Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types. |
| 14800000 | Inner error. |
| 14800010 | Invalid database path. |
| 14800011 | Database corrupted. |
| 14801001 | Only supported in stage mode. |
| 14801002 | The data group id is not valid. |
| 14800017 | Config changed. |
| 14800021 | SQLite: Generic error. |
| 14800022 | SQLite: Callback routine requested an abort. |
| 14800023 | SQLite: Access permission denied. |
| 14800027 | SQLite: Attempt to write a readonly database. |
| 14800028 | SQLite: Some kind of disk I/O error occurred. |
| 14800029 | SQLite: The database is full. |
| 14800030 | SQLite: Unable to open the database file. |



## Classes

### RdbPredicates

class RdbPredicates
```cangjie
public class RdbPredicates { public init(name: String) }
```
功能： 表示关系型数据库（RDB）的谓词。该类确定RDB中条件表达式的值是true还是false。该类型不是多线程安全的，如果应用中存在多线程同时操作该类派生出的实例，注意加锁保护。


### RdbStore

class RdbStore
```cangjie
public class RdbStore {}
```
功能： 提供管理关系数据库（RDB）方法的接口。

#### prop version

```cangjie
public mut prop version: Int32
```
功能： 设置和获取数据库版本，值为大于等于0的整数。
Type: Int32; Readable: true; Writable: true


### ResultSet

class ResultSet
```cangjie
public class ResultSet {}
```
功能： 提供通过查询数据库生成的数据库结果集的访问方法。结果集是指用户调用关系型数据库查询接口之后返回的结果集合，提供了多种灵活的数据访问方式，以便用户获取各项数据。

#### prop columnCount

```cangjie
public prop columnCount: Int32
```
功能： 获取结果集中的列数。
Type: Int32; Readable: true; Writable: false

#### prop columnNames

```cangjie
public prop columnNames: Array<String>
```
功能： 获取结果集中所有列的名称。
Type: Array<String>; Readable: true; Writable: false

#### prop isAtFirstRow

```cangjie
public prop isAtFirstRow: Bool
```
功能： 检查结果集是否位于第一行。
Type: Bool; Readable: true; Writable: false

#### prop isAtLastRow

```cangjie
public prop isAtLastRow: Bool
```
功能： 检查结果集是否位于最后一行。
Type: Bool; Readable: true; Writable: false

#### prop isClosed

```cangjie
public prop isClosed: Bool
```
功能： 检查当前结果集是否关闭。
Type: Bool; Readable: true; Writable: false

#### prop isEnded

```cangjie
public prop isEnded: Bool
```
功能： 检查结果集是否位于最后一行之后。
Type: Bool; Readable: true; Writable: false

#### prop isStarted

```cangjie
public prop isStarted: Bool
```
功能： 检查指针是否移动过。
Type: Bool; Readable: true; Writable: false

#### prop rowCount

```cangjie
public prop rowCount: Int32
```
功能： 获取结果集中的行数。
Type: Int32; Readable: true; Writable: false

#### prop rowIndex

```cangjie
public prop rowIndex: Int32
```
功能： 获取结果集当前行的索引。
Type: Int32; Readable: true; Writable: false


### StoreConfig

class StoreConfig
```cangjie
public class StoreConfig { public let name: String public let securityLevel: RelationalStoreSecurityLevel public let encrypt: Bool public let dataGroupId: String public let customDir: String public let autoCleanDirtyData: Bool public init(name: String, securityLevel: RelationalStoreSecurityLevel, encrypt!: Bool = false, dataGroupId!: String = "", customDir!: String = "", autoCleanDirtyData!: Bool = true) }
```
功能： 管理关系数据库配置。

#### let autoCleanDirtyData

```cangjie
public let autoCleanDirtyData: Bool
```
功能： 指定是否自动清理云端删除后同步到本地的数据，true表示自动清理，false表示手动清理，默认自动清理。对于端云协同的数据库，当云端删除的数据同步到设备端时，可通过该参数设置设备端是否自动清理。手动清理可以通过cleanDirtyData接口清理。
Type: Bool; Readable: true; Writable: false

#### let customDir

```cangjie
public let customDir: String
```
功能： 数据库自定义路径。
Type: String; Readable: true; Writable: false

#### let dataGroupId

```cangjie
public let dataGroupId: String
```
功能： 应用组ID，需要向应用市场获取。
Type: String; Readable: true; Writable: false

#### let encrypt

```cangjie
public let encrypt: Bool
```
功能： 指定数据库是否加密，默认不加密。true: 加密。false: 非加密。
Type: Bool; Readable: true; Writable: false

#### let name

```cangjie
public let name: String
```
功能： 数据库文件名。
Type: String; Readable: true; Writable: false

#### let securityLevel

```cangjie
public let securityLevel: RelationalStoreSecurityLevel
```
功能： 设置数据库安全级别。
Type: RelationalStoreSecurityLevel; Readable: true; Writable: false



## Structs

### Asset

struct Asset
```cangjie
public struct Asset { public let name: String public let uri: String public let path: String public let createTime: String public let modifyTime: String public let size: String public let status: AssetStatus public init(name: String, uri: String, path: String, createTime: String, modifyTime: String, size: String, status!: AssetStatus = AssetStatus.ASSET_NORMAL) }
```
功能： 记录资产附件（文件、图片、视频等类型文件）的相关信息。资产类型的相关接口暂不支持Datashare。


### ChangeInfo

struct ChangeInfo
```cangjie
public struct ChangeInfo { public let table: String public let `type`: ChangeType public let inserted: Array<PRIKeyType> public let updated: Array<PRIKeyType> public let deleted: Array<PRIKeyType> public init(table: String, `type`: ChangeType, inserted: Array<PRIKeyType>, updated: Array<PRIKeyType>, deleted: Array<PRIKeyType>) }
```
功能： 记录端云同步过程详情。


### DistributedConfig

struct DistributedConfig
```cangjie
public struct DistributedConfig { public let autoSync: Bool public init(autoSync: Bool) }
```
功能： 记录表的分布式配置信息。


### ProgressDetails

struct ProgressDetails
```cangjie
public struct ProgressDetails { public let schedule: Progress public let code: ProgressCode public let details: Map<String, TableDetails> public init(schedule: Progress, code: ProgressCode, details: Map<String, TableDetails>) }
```
功能： 描述数据库整体执行端云同步任务上传和下载的统计信息。


### Statistic

struct Statistic
```cangjie
public struct Statistic { public let total: UInt32 public let successful: UInt32 public let failed: UInt32 public let remained: UInt32 public init(total: UInt32, successful: UInt32, failed: UInt32, remained: UInt32) }
```
功能： 描述数据库表的端云同步过程的统计信息。


### TableDetails

struct TableDetails
```cangjie
public struct TableDetails { public let upload: Statistic public let download: Statistic public init(upload: Statistic, download: Statistic) }
```
功能： 描述数据库表执行端云同步任务上传和下载的统计信息。



## Enums

### AssetStatus

enum AssetStatus
```cangjie
public enum AssetStatus { | ASSET_NORMAL | ASSET_INSERT | ASSET_UPDATE | ASSET_DELETE | ASSET_ABNORMAL | ASSET_DOWNLOADING | ... }
```
功能： 描述资产附件的状态枚举。

#### ASSET_ABNORMAL

```cangjie
ASSET_ABNORMAL
```
功能： 表示资产状态异常。

#### ASSET_DELETE

```cangjie
ASSET_DELETE
```
功能： 表示资产需要在云端删除。

#### ASSET_DOWNLOADING

```cangjie
ASSET_DOWNLOADING
```
功能： 表示资产正在下载到本地设备。

#### ASSET_INSERT

```cangjie
ASSET_INSERT
```
功能： 表示资产需要插入到云端。

#### ASSET_NORMAL

```cangjie
ASSET_NORMAL
```
功能： 表示资产状态正常。

#### ASSET_UPDATE

```cangjie
ASSET_UPDATE
```
功能： 表示资产需要更新到云端。


### ChangeType

enum ChangeType
```cangjie
public enum ChangeType { | DATA_CHANGE | ASSET_CHANGE | ... }
```
功能： 描述数据变更类型。

#### ASSET_CHANGE

```cangjie
ASSET_CHANGE
```
功能： 表示是资产附件发生了变更。

#### DATA_CHANGE

```cangjie
DATA_CHANGE
```
功能： 表示是数据发生变更。


### ConflictResolution

enum ConflictResolution
```cangjie
public enum ConflictResolution { | ON_CONFLICT_NONE | ON_CONFLICT_ROLLBACK | ON_CONFLICT_ABORT | ON_CONFLICT_FAIL | ON_CONFLICT_IGNORE | ON_CONFLICT_REPLACE | ... }
```
功能： 插入和修改接口的冲突解决方式。

#### ON_CONFLICT_ABORT

```cangjie
ON_CONFLICT_ABORT
```
功能： 表示当冲突发生时，中止当前SQL语句，并撤销当前SQL语句所做的任何更改，但是由同一事务中先前的SQL语句引起的更改被保留并且事务保持活动状态。

#### ON_CONFLICT_FAIL

```cangjie
ON_CONFLICT_FAIL
```
功能： 表示当冲突发生时，中止当前SQL语句。但它不会撤销失败的SQL语句的先前更改，也不会结束事务。

#### ON_CONFLICT_IGNORE

```cangjie
ON_CONFLICT_IGNORE
```
功能： 表示当冲突发生时，跳过包含违反约束的行并继续处理SQL语句的后续行。

#### ON_CONFLICT_NONE

```cangjie
ON_CONFLICT_NONE
```
功能： 表示当冲突发生时，不做任何处理。

#### ON_CONFLICT_REPLACE

```cangjie
ON_CONFLICT_REPLACE
```
功能： 表示当冲突发生时，在插入或更新当前行之前删除导致约束违例的预先存在的行，并且命令会继续正常执行。

#### ON_CONFLICT_ROLLBACK

```cangjie
ON_CONFLICT_ROLLBACK
```
功能： 表示当冲突发生时，中止SQL语句并回滚当前事务。


### DistributedType

enum DistributedType
```cangjie
public enum DistributedType { | DISTRIBUTED_DEVICE | DISTRIBUTED_CLOUD | ... }
```
功能： 描述表的分布式类型。

#### DISTRIBUTED_CLOUD

```cangjie
DISTRIBUTED_CLOUD
```
功能： 表示在设备和云端之间分布式的数据库表。

#### DISTRIBUTED_DEVICE

```cangjie
DISTRIBUTED_DEVICE
```
功能： 表示在不同设备之间分布式的数据库表。


### Field

enum Field
```cangjie
public enum Field { | CURSOR_FIELD | ORIGIN_FIELD | DELETED_FLAG_FIELD | OWNER_FIELD | PRIVILEGE_FIELD | SHARING_RESOURCE_FIELD | ... }
```
功能： 用于谓词查询条件的特殊字段。

#### CURSOR_FIELD

```cangjie
CURSOR_FIELD
```
功能： 用于cursor查找的字段名。

#### DELETED_FLAG_FIELD

```cangjie
DELETED_FLAG_FIELD
```
功能： 用于cursor查找的结果集返回时填充的字段，表示云端删除的数据同步到本地后数据是否清理。返回的结果集中，该字段对应的value为false表示数据未清理，true表示数据已清理。

#### ORIGIN_FIELD

```cangjie
ORIGIN_FIELD
```
功能： 用于cursor查找时指定数据来源的字段名。

#### OWNER_FIELD

```cangjie
OWNER_FIELD
```
功能： 用于共享表中查找owner时返回的结果集中填充的字段，表示当前共享记录的共享发起者。

#### PRIVILEGE_FIELD

```cangjie
PRIVILEGE_FIELD
```
功能： 用于共享表中查找共享数据权限时返回的结果集中填充的字段，表示当前共享记录的允许的操作权限。

#### SHARING_RESOURCE_FIELD

```cangjie
SHARING_RESOURCE_FIELD
```
功能： 用于数据共享时查找共享数据的共享资源时返回的结果集中填充的字段，表示共享数据的共享资源标识。


### Origin

enum Origin
```cangjie
public enum Origin { | LOCAL | CLOUD | REMOTE | ... }
```
功能： 表示数据来源。

#### CLOUD

```cangjie
CLOUD
```
功能： 表示云端同步的数据。

#### LOCAL

```cangjie
LOCAL
```
功能： 表示本地数据。

#### REMOTE

```cangjie
REMOTE
```
功能： 表示端端同步的数据。


### PRIKeyType

enum PRIKeyType
```cangjie
public enum PRIKeyType <: Hashable & Equatable<PRIKeyType> { | Integer(Int64) | Double(Float64) | Str(String) | ... }
```
功能： 用于表示数据库表某一行主键的数据类型。

#### Double(Float64)

```cangjie
Double(Float64)
```
功能： 表示值类型为浮点型数字。

#### Integer(Int64)

```cangjie
Integer(Int64)
```
功能： 表示值类型为整型数字。

#### Str(String)

```cangjie
Str(String)
```
功能： 表示值类型为字符串。


### Progress

enum Progress
```cangjie
public enum Progress { | SYNC_BEGIN | SYNC_IN_PROGRESS | SYNC_FINISH | ... }
```
功能： 描述端云同步过程。

#### SYNC_BEGIN

```cangjie
SYNC_BEGIN
```
功能： 表示端云同步过程开始。

#### SYNC_FINISH

```cangjie
SYNC_FINISH
```
功能： 表示端云同步过程已完成。

#### SYNC_IN_PROGRESS

```cangjie
SYNC_IN_PROGRESS
```
功能： 表示正在端云同步过程中。


### ProgressCode

enum ProgressCode
```cangjie
public enum ProgressCode { | SUCCESS | UNKNOWN_ERROR | NETWORK_ERROR | CLOUD_DISABLED | LOCKED_BY_OTHERS | RECORD_LIMIT_EXCEEDED | NO_SPACE_FOR_ASSET | ... }
```
功能： 表示端云同步过程的状态。

#### CLOUD_DISABLED

```cangjie
CLOUD_DISABLED
```
功能： 表示云端不可用。

#### LOCKED_BY_OTHERS

```cangjie
LOCKED_BY_OTHERS
```
功能： 表示有其他设备正在端云同步，本设备无法进行端云同步。请确保无其他设备占用云端资源后，再使用本设备进行端云同步任务。

#### NETWORK_ERROR

```cangjie
NETWORK_ERROR
```
功能： 表示端云同步过程遇到网络错误。

#### NO_SPACE_FOR_ASSET

```cangjie
NO_SPACE_FOR_ASSET
```
功能： 表示云空间剩余空间小于待同步的资产大小。

#### RECORD_LIMIT_EXCEEDED

```cangjie
RECORD_LIMIT_EXCEEDED
```
功能： 表示本次端云同步需要同步的条目或大小超出最大值。由云端配置最大值。

#### SUCCESS

```cangjie
SUCCESS
```
功能： 表示端云同步过程成功。

#### UNKNOWN_ERROR

```cangjie
UNKNOWN_ERROR
```
功能： 表示端云同步过程遇到未知错误。


### RelationalStoreSecurityLevel

enum RelationalStoreSecurityLevel
```cangjie
public enum RelationalStoreSecurityLevel { | S1 | S2 | S3 | S4 | ... }
```
功能： 数据库的安全级别枚举。

#### S1

```cangjie
S1
```
功能： 表示数据库的安全级别为低级别，当数据泄露时会产生较低影响。例如，包含壁纸等系统数据的数据库。

#### S2

```cangjie
S2
```
功能： 表示数据库的安全级别为中级别，当数据泄露时会产生较大影响。例如，包含录音、视频等用户生成数据或通话记录等信息的数据库。

#### S3

```cangjie
S3
```
功能： 表示数据库的安全级别为高级别，当数据泄露时会产生重大影响。例如，包含用户运动、健康、位置等信息的数据库。

#### S4

```cangjie
S4
```
功能： 表示数据库的安全级别为关键级别，当数据泄露时会产生严重影响。例如，包含认证凭据、财务数据等信息的数据库。


### SubscribeType

enum SubscribeType
```cangjie
public enum SubscribeType { | SUBSCRIBE_TYPE_REMOTE | SUBSCRIBE_TYPE_CLOUD | SUBSCRIBE_TYPE_CLOUD_DETAILS | ... }
```
功能： 描述订阅类型。

#### SUBSCRIBE_TYPE_CLOUD

```cangjie
SUBSCRIBE_TYPE_CLOUD
```
功能： 订阅云端数据更改。

#### SUBSCRIBE_TYPE_CLOUD_DETAILS

```cangjie
SUBSCRIBE_TYPE_CLOUD_DETAILS
```
功能： 订阅云端数据更改详情。

#### SUBSCRIBE_TYPE_REMOTE

```cangjie
SUBSCRIBE_TYPE_REMOTE
```
功能： 订阅远程数据更改。


### SyncMode

enum SyncMode
```cangjie
public enum SyncMode { | SYNC_MODE_PUSH | SYNC_MODE_PULL | SYNC_MODE_TIME_FIRST | SYNC_MODE_NATIVE_FIRST | SYNC_MODE_CLOUD_FIRST | ... }
```
功能： 指数据库同步模式。

#### SYNC_MODE_CLOUD_FIRST

```cangjie
SYNC_MODE_CLOUD_FIRST
```
功能： 表示数据从云端同步到本地设备。

#### SYNC_MODE_NATIVE_FIRST

```cangjie
SYNC_MODE_NATIVE_FIRST
```
功能： 表示数据从本地设备同步到云端。

#### SYNC_MODE_PULL

```cangjie
SYNC_MODE_PULL
```
功能： 表示数据从远程设备拉至本地设备。

#### SYNC_MODE_PUSH

```cangjie
SYNC_MODE_PUSH
```
功能： 表示数据从本地设备推送到远程设备。

#### SYNC_MODE_TIME_FIRST

```cangjie
SYNC_MODE_TIME_FIRST
```
功能： 表示数据从修改时间较近的一端同步到修改时间较远的一端。


### RelationalStoreValueType

enum RelationalStoreValueType
```cangjie
public enum RelationalStoreValueType { | null | integer(Int64) | double(Float64) | string(String) | boolean(Bool) | Uint8Array(Array<UInt8>) | AssetEnum(Asset) | AssetsEnum(Array<Asset>) | ... }
```
功能： 用于表示允许的数据字段类型，接口参数具体类型根据其功能而定。

#### AssetEnum(Asset)

```cangjie
AssetEnum(Asset)
```
功能： 表示值类型为附件 Asset 。

#### AssetsEnum(Array<Asset>)

```cangjie
AssetsEnum(Array<Asset>)
```
功能： 表示值类型为附件数组Array< Asset >。

#### Uint8Array(Array<UInt8>)

```cangjie
Uint8Array(Array<UInt8>)
```
功能： 表示值类型为UInt8类型的数组。

#### boolean(Bool)

```cangjie
boolean(Bool)
```
功能： 表示值类型为布尔值。

#### double(Float64)

```cangjie
double(Float64)
```
功能： 表示值类型为浮点型数字。

#### integer(Int64)

```cangjie
integer(Int64)
```
功能： 表示值类型为整型数字。

#### null

```cangjie
null
```
功能： 表示值类型为空。

#### string(String)

```cangjie
string(String)
```
功能： 表示值类型为字符。



