# WaterFlow

瀑布流容器，由“行”和“列”分割的单元格所组成，通过容器自身的排列规则，将不同大小的“项目”自上而下，如瀑布般紧密布局。

## Component Constructors

### public init( footer!: () -> Unit = { => }, scroller!: ?Scroller = None, waterFlowSections!: ?WaterFlowSections = None, layoutMode!: WaterFlowLayoutMode = WaterFlowLayoutMode.ALWAYS_TOP_DOWN )

```cangjie
public init( footer!: () -> Unit = { => }, scroller!: ?Scroller = None, waterFlowSections!: ?WaterFlowSections = None, layoutMode!: WaterFlowLayoutMode = WaterFlowLayoutMode.ALWAYS_TOP_DOWN )
```
功能： 创建一个WaterFlow容器。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ()->Unit | 否 | 命名参数。 设置WaterFlow尾部组件。使用时结合 @Builder 和 bind 方法使用。 | footer | { => } |
| ? Scroller | 否 | 命名参数。 可滚动组件的控制器，与可滚动组件绑定。子组件与子组件之间间隙。 说明： 不允许和其他滚动类组件，如： List 、 Grid 、 Scroll 和 WaterFlow 绑定同一个滚动控制对象。 | scroller | None |
| ? WaterFlowSections | 否 | 命名参数。 设置FlowItem分组，实现同一个瀑布流组件内部各分组使用不同列数混合布局。 说明： 使用分组混合布局时会忽略columnsTemplate和rowsTemplate属性。 使用分组混合布局时不支持单独设置footer，可以使用最后一个分组作为尾部组件。 | waterFlowSections | None |
| WaterFlowLayoutMode | 否 | 命名参数。 设置WaterFlow的布局模式，根据使用场景选择更切合的模式。 初始值： ALWAYS_TOP_DOWN 。 | layoutMode | ALWAYS_TOP_DOWN |

### public init( footer!: () -> Unit = { => }, scroller!: ?Scroller = None, waterFlowSections!: ?WaterFlowSections = None, layoutMode!: WaterFlowLayoutMode = WaterFlowLayoutMode.ALWAYS_TOP_DOWN, child!: () -> Unit )

```cangjie
public init( footer!: () -> Unit = { => }, scroller!: ?Scroller = None, waterFlowSections!: ?WaterFlowSections = None, layoutMode!: WaterFlowLayoutMode = WaterFlowLayoutMode.ALWAYS_TOP_DOWN, child!: () -> Unit )
```
功能： 创建一个WaterFlow容器。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ()->Unit | 否 | 命名参数。 设置WaterFlow尾部组件。使用时结合 @Builder 和 bind 方法使用。 | footer | { => } |
| ? Scroller | 否 | 命名参数。 可滚动组件的控制器，与可滚动组件绑定。子组件与子组件之间间隙。 说明： 不允许和其他滚动类组件，如： List 、 Grid 、 Scroll 和 WaterFlow 绑定同一个滚动控制对象。 | scroller | None |
| ? WaterFlowSections | 否 | 命名参数。 设置FlowItem分组，实现同一个瀑布流组件内部各分组使用不同列数混合布局。 说明： 使用分组混合布局时会忽略columnsTemplate和rowsTemplate属性。 使用分组混合布局时不支持单独设置footer，可以使用最后一个分组作为尾部组件。 | waterFlowSections | None |
| WaterFlowLayoutMode | 否 | 命名参数。 设置WaterFlow的布局模式，根据使用场景选择更切合的模式。 初始值： ALWAYS_TOP_DOWN 。 | layoutMode | WaterFlowLayoutMode.ALWAYS_TOP_DOWN |
| ()->Unit | 是 | 命名参数。 WaterFlow的子组件。 | child | - |


## Functions

### public func cachedCount(value: Int32, show: Bool): This

```cangjie
public func cachedCount(value: Int32, show: Bool): This
```
功能： 设置预加载的FlowItem数量，并配置是否显示预加载节点。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 预加载的FlowItem的数量。 初始值：根据屏幕内显示的节点个数设置，最大值为16。 取值范围：[0, +∞)，设置为小于0的值时，按1处理。 | value | - |
| Bool | 是 | 被预加载的FlowItem是否需要显示。设置为true时显示预加载的FlowItem，设置为false时不显示预加载的FlowItem。 初始值值：false。 | show | - |

### public func columnsGap(value: Length): This

```cangjie
public func columnsGap(value: Length): This
```
功能： 设置列与列的间距。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Length | 是 | 列与列的间距。 初始值：0。 取值范围：[0, +∞)。 | value | - |

### public func columnsTemplate(value: String): This

```cangjie
public func columnsTemplate(value: String): This
```
功能： 设置当前瀑布流组件布局列的数量，不设置时默认1列。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| String | 是 | 当前瀑布流组件布局列的数量。 初始值："1fr"。 | value | - |

### public func enableScrollInteraction(value: Bool): This

```cangjie
public func enableScrollInteraction(value: Bool): This
```
功能： 设置是否支持滚动手势。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Bool | 是 | 是否支持滚动手势。设置为true时可以通过手指或者鼠标滚动，设置为false时无法通过手指或者鼠标滚动，但不影响控制器 Scroller 的滚动接口。 初始值：true。 | value | - |

### public func friction(value: Float64): This

```cangjie
public func friction(value: Float64): This
```
功能： 设置摩擦系数，手动划动滚动区域时生效，只对惯性滚动过程有影响，对惯性滚动过程中的链式效果有间接影响。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Float64 | 是 | 摩擦系数。 初始值：非可穿戴设备为0.75，可穿戴设备为0.9。 取值范围：(0, +∞)，设置为小于等于0的值时，按初始值处理。 | value | - |

### public func friction(value: Int32): This

```cangjie
public func friction(value: Int32): This
```
功能： 设置摩擦系数，手动划动滚动区域时生效，只对惯性滚动过程有影响，对惯性滚动过程中的链式效果有间接影响。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 摩擦系数。 初始值：非可穿戴设备为0.75，可穿戴设备为0.9。 取值范围：(0, +∞)，设置为小于等于0的值时，按初始值处理。 | value | - |

### public func itemConstraintSize(minWidth: Length, maxWidth: Length, minHeight: Length, maxHeight: Length): This

```cangjie
public func itemConstraintSize(minWidth: Length, maxWidth: Length, minHeight: Length, maxHeight: Length): This
```
功能： 设置约束尺寸，子组件布局时，进行尺寸范围限制。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Length | 是 | 元素最小宽度。 | minWidth | - |
| Length | 是 | 元素最大宽度。 | maxWidth | - |
| Length | 是 | 元素最小高度。 | minHeight | - |
| Length | 是 | 元素最大高度。 | maxHeight | - |

### public func layoutDirection(value: FlexDirection): This

```cangjie
public func layoutDirection(value: FlexDirection): This
```
功能： 设置布局的主轴方向。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| FlexDirection | 是 | 设置布局的主轴方向， 初始值：FlexDirection.Column。 | value | - |

### public func nestedScroll( scrollForward !: NestedScrollMode = NestedScrollMode.SELF_ONLY, scrollBackward !: NestedScrollMode = NestedScrollMode.SELF_ONLY ): This

```cangjie
public func nestedScroll( scrollForward !: NestedScrollMode = NestedScrollMode.SELF_ONLY, scrollBackward !: NestedScrollMode = NestedScrollMode.SELF_ONLY ): This
```
功能： 设置向前和向后两个方向上的嵌套滚动模式，实现与父组件的滚动联动。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NestedScrollMode | 否 | 命名参数。 滚动组件往末尾端滚动时的嵌套滚动选项。 | scrollForward | NestedScrollMode.SELF_ONLY |
| NestedScrollMode | 否 | 命名参数。 滚动组件往起始端滚动时的嵌套滚动选项。 | scrollBackward | NestedScrollMode.SELF_ONLY |

### public func nestedScroll(value: NestedScrollOptions): This

```cangjie
public func nestedScroll(value: NestedScrollOptions): This
```
功能： 设置向前和向后两个方向上的嵌套滚动模式，实现与父组件的滚动联动。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NestedScrollOptions | 是 | 嵌套滚动选项。 | value | - |

### public func rowsGap(size: Length): This

```cangjie
public func rowsGap(size: Length): This
```
功能： 设置行与行的间距。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Length | 是 | 行与行的间距。 初始值：0。 取值范围：[0, +∞)。 | size | - |

### public func rowsTemplate(value: String): This

```cangjie
public func rowsTemplate(value: String): This
```
**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| String | 是 | 当前瀑布流组件布局行的数量。 初始值："1fr"。 | value | - |

### public func onReachEnd(callback: () -> Unit): This

```cangjie
public func onReachEnd(callback: () -> Unit): This
```
功能： 瀑布流组件到底末尾位置时触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ()->Unit | 是 | 网瀑布流组件到底末尾位置时触发该事件。 | callback | - |

### public func onReachStart(callback: () -> Unit): This

```cangjie
public func onReachStart(callback: () -> Unit): This
```
功能： 瀑布流组件到达起始位置时触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ()->Unit | 是 | 瀑布流组件到达起始位置时触发该事件。 | callback | - |

### public func onScrollFrameBegin(callback: (Float64, ScrollState) -> Float64): This

```cangjie
public func onScrollFrameBegin(callback: (Float64, ScrollState) -> Float64): This
```
**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| (Float64, ScrollState )->Float64 | 是 | 瀑布流开始滑动时触发的回调函数。 参数一：即将发生的滑动量，单位vp。 参数二：当前滑动状态。 | callback | - |

### public func onScrollIndex(callback: (Int32, Int32) -> Unit): This

```cangjie
public func onScrollIndex(callback: (Int32, Int32) -> Unit): This
```
功能： 当前瀑布流显示的起始位置/终止位置的子组件发生变化时触发。瀑布流初始化时会触发一次。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| (Int32,Int32)->Unit | 是 | 当前瀑布流显示的起始位置/终止位置的子组件发生变化时触发的回调函数。 参数一：当前显示的瀑布流起始位置的索引值。 取值范围：[0, 子节点总数-1]。 参数二：当前显示的瀑布流终止位置的索引值。 取值范围：[0, 子节点总数-1]。 | callback | - |


## Classes

### WaterFlowSections

class WaterFlowSections
```cangjie
public class WaterFlowSections { public init() }
```
功能： 瀑布流分组信息。


### SectionOptions

class SectionOptions
```cangjie
public class SectionOptions { public var itemsCount: UInt32 public var crossCount: Int32 public var columnsGap: Option<Length> public var rowsGap: Option<Length> public var margin: Margin public var onGetItemMainSizeByIndex: Option <(Float64) -> Int32> public init( itemsCount!: UInt32, margin!: Margin, onGetItemMainSizeByIndex!: Option<(Float64)-> Int32> = None, crossCount!: Int32 = 1, columnsGap!: Option<Length> = None, rowsGap!: Option<Length> = None ) public init( itemsCount!: UInt32, margin!: Length = 0.vp, onGetItemMainSizeByIndex!: Option<(Float64)-> Int32> = None, crossCount!: Int32 = 1, columnsGap!: Option<Length> = None, rowsGap!: Option<Length> = None ) }
```
功能： FlowItem分组配置信息。

#### var columnsGap

```cangjie
public var columnsGap: Option<Length>
```
功能： 该分组的列间距。
Type: Option< Length >; Readable: true; Writable: true

#### var crossCount

```cangjie
public var crossCount: Int32
```
功能： 纵向布局时为列数，横向布局时为行数。
Type: Int32; Readable: true; Writable: true

#### var itemsCount

```cangjie
public var itemsCount: UInt32
```
功能： 分组中FlowItem数量。
Type: UInt32; Readable: true; Writable: true

#### var margin

```cangjie
public var margin: Margin
```
功能： 该分组的外边距参数。
Type: Margin; Readable: true; Writable: true

#### var onGetItemMainSizeByIndex

```cangjie
public var onGetItemMainSizeByIndex: Option <(Float64) -> Int32>
```
功能： 瀑布流组件布局过程中获取指定index的FlowItem的主轴大小，纵向瀑布流时为高度，横向瀑布流时为宽度，单位vp。
Type: Option<(Float64)->Int32>; Readable: true; Writable: true

#### var rowsGap

```cangjie
public var rowsGap: Option<Length>
```
功能： 该分组的行间距。
Type: Option< Length >; Readable: true; Writable: true



## Enums

### WaterFlowDirection

enum WaterFlowDirection
```cangjie
public enum WaterFlowDirection { | Row | Column | RowReverse | ColumnReverse }
```
功能： 布局的主轴方向。

#### Column

```cangjie
Column
```
功能： 主轴与列方向一致作为布局模式。

#### ColumnReverse

```cangjie
ColumnReverse
```
功能： 与Column相反方向进行布局。

#### Row

```cangjie
Row
```
功能： 主轴与行方向一致作为布局模式。

#### RowReverse

```cangjie
RowReverse
```
功能： 与Row方向相反方向进行布局。


### WaterFlowLayoutMode

enum WaterFlowLayoutMode
```cangjie
public enum WaterFlowLayoutMode { | ALWAYS_TOP_DOWN | SLIDING_WINDOW }
```
功能： WaterFlow的布局模式。

#### ALWAYS_TOP_DOWN

```cangjie
ALWAYS_TOP_DOWN
```
功能： 默认的从上到下的布局模式。视窗内的FlowItem依赖视窗上方所有FlowItem的布局信息。因此跳转或切换列数时，需要计算出上方所有的FlowItem的布局信息。

#### SLIDING_WINDOW

```cangjie
SLIDING_WINDOW
```
功能： 移动窗口式的布局模式。只考虑视窗内的布局信息，对视窗上方的FlowItem没有依赖关系，因此向后跳转或切换列数时只需要布局视窗内的FlowItem。有频繁切换列数的场景的应用建议使用该模式。



## Examples

```cangjie
package ohos_app_cangjie_entry
import kit.UIKit.*
import ohos.state_macro_manage.*
import std.collection.*

class MyDataSource <: IDataSource<Int64> {
 public MyDataSource(let data_: ArrayList<Int64>) {}
 public var listenerOp: Option<DataChangeListener> = None
 public func getData(index: Int64): Int64 {
 return data_[index]
 }

 public func onRegisterDataChangeListener(listener: DataChangeListener): Unit {
 listenerOp = listener
 }

 public func onUnregisterDataChangeListener(listener: DataChangeListener): Unit {
 listenerOp = None
 }

 public func totalCount(): Int64 {
 return data_.size
 }

 public func addLastItem(): Unit {
 data_.add(data_.size)
 }

 public func notifyReloaded(): Unit {
 let listener: DataChangeListener = listenerOp.getOrThrow()
 listener.onDataReloaded()
 }
}

@Entry
@Component
class EntryView {
 @State
 var message: String = "Hello Cangjie"
 @State
 var myDataSource: MyDataSource = MyDataSource(ArrayList<Int64>(100, {i => i}))
 @State
 var myHight: Array<Int64> = [200, 212, 334, 265, 214]
 var myScroller: Scroller = Scroller()

 @Builder
 func itemFoot(): Unit {
 Column() {
 Text("Footer")
 .fontSize(10)
 .backgroundColor(0xFFE700)
 .width(50)
 .height(50)
 .align(Alignment.Center)
 .margin(2.vp)
 }
 }

 func build() {
 Column() {
 WaterFlow(footer: bind(itemFoot, this), scroller: myScroller, layoutMode: WaterFlowLayoutMode.ALWAYS_TOP_DOWN) {
 LazyForEach(
 this.myDataSource,
 itemGeneratorFunc: {
 element: Int64, index: Int64 =>
 FlowItem() {
 Column() {
 Text(element.toString()).fontSize(12).height(16.vp)
 }
 }
 .width(100.percent)
 .height(myHight[element % 5])
 .backgroundColor(0xFFD700)
 }
 )
 }
 .layoutDirection(FlexDirection.Column)
 .itemConstraintSize(20.vp, 300.vp, 20.vp, 300.vp)
 .columnsTemplate("1fr 1fr")
 .columnsGap(10.vp)
 .rowsGap(5.vp)
 .backgroundColor(0xFAEEE0)
 .enableScrollInteraction(true)
 .friction(0.7)
 .cachedCount(20, true)
 .width(100.percent)
 .height(100.percent)
 .onReachStart({=>
 AppLog.info('waterFlow reach start')
 })
 .onReachEnd({=>
 AppLog.info('waterFlow reach start')
 })
 .onScrollFrameBegin({offset: Float64, state: ScrollState =>
 AppLog.info("waterFlow scrollFrameBegin offset: " + offset.toString() + " state: " + state.toString())
 return offset
 })
 .onScrollIndex({first: Int32, last: Int32=>
 AppLog.info("waterFlow onScrollIndex first: " + first.toString() + " last: " + last.toString() + " totalCount: " + this.myDataSource.totalCount().toString())
 })
 }.height(100.percent)
 }
}
```

