# ohos.background_task_mgr（后台任务管理）

本模块提供申请后台任务的接口。当应用退至后台时，开发者可以通过本模块接口为应用申请短时、长时任务，避免应用进程被终止或挂起。

```cangjie
import kit.BackgroundTasksKit.*
```
## Functions

### public func cancelSuspendDelay(requestId: Int32): Unit

```cangjie
public func cancelSuspendDelay(requestId: Int32): Unit
```
功能： 取消短时任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 短时任务的请求ID。 | requestId | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 backgroundTaskManager错误码 。

| code | description |
| --- | --- |
| 9800001 | Memory operation failed. |
| 9800002 | Parcel operation failed. |
| 9800003 | Inner transact failed. |
| 9800004 | System service operation failed. |
| 9900001 | Caller information verification failed. |
| 9900002 | Background task verification failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

let id: Int32 = 1
try {
 cancelSuspendDelay(id)
} catch (e: BusinessException) {
 AppLog.info("cancelSuspendDelay failed. code is ${e.code} message is ${e.message}")
}
```

### public func getRemainingDelayTime(requestId: Int32): Int32

```cangjie
public func getRemainingDelayTime(requestId: Int32): Int32
```
功能： 获取本次短时任务的剩余时间。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 短时任务的请求ID。 | requestId | - |

**Returns:**

| type | description |
| --- | --- |
| Int32 | 返回本次短时任务的剩余时间，单位为毫秒。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 backgroundTaskManager错误码 。

| code | description |
| --- | --- |
| 9800001 | Memory operation failed. |
| 9800002 | Parcel operation failed. |
| 9800003 | Inner transact failed. |
| 9800004 | System service operation failed. |
| 9900001 | Caller information verification failed. |
| 9900002 | Background task verification failed. |


**Example:**

```cangjie
// index.cj

import kit.BackgroundTasksKit.*

let id: Int32 = 1
let time = getRemainingDelayTime(id)
```

### public func requestSuspendDelay(reason: String, callback: () -> Unit): DelaySuspendInfo

```cangjie
public func requestSuspendDelay(reason: String, callback: () -> Unit): DelaySuspendInfo
```
功能： 申请短时任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| String | 是 | 申请短时任务的原因。 | reason | - |
| () -> Unit | 是 | 短时任务即将超时的回调函数，一般在超时前6秒，通过此回调通知应用。 | callback | - |

**Returns:**

| type | description |
| --- | --- |
| DelaySuspendInfo | 返回短时任务信息。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 backgroundTaskManager错误码 。

| code | description |
| --- | --- |
| 9800001 | Memory operation failed. |
| 9800002 | Parcel operation failed. |
| 9800003 | Inner transact failed. |
| 9800004 | System service operation failed. |
| 9900001 | Caller information verification failed. |
| 9900002 | Background task verification failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

let myReason = "test requestSuspendDelay"
try {
 let delayInfo = requestSuspendDelay(myReason, { =>
 AppLog.info("Request suspension delay will time out.")
 })
 let id = delayInfo.requestId
 let time = delayInfo.actualDelayTime
 AppLog.info("The requestId is: ${id}")
 AppLog.info("The actualDelayTime is: ${time}")
} catch (e: BusinessException) {
 AppLog.info("requestSuspendDelay failed. code is ${e.code} message is ${e.message}")
}
```

### public func stopBackgroundRunning(context: StageContext): Unit

```cangjie
public func stopBackgroundRunning(context: StageContext): Unit
```
功能： 向系统申请取消长时任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| StageContext | 是 | 应用运行的上下文。 | context | - |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

let stageContext = Global.getStageContext() // 需获取Context应用上下文，详见本文使用说明
stopBackgroundRunning(stageContext)
```


## Classes

### DelaySuspendInfo

class DelaySuspendInfo
```cangjie
public class DelaySuspendInfo { public DelaySuspendInfo( public let requestId: Int32, public let actualDelayTime: Int32 ) }
```
功能： 短时任务信息。

#### let actualDelayTime

```cangjie
public let actualDelayTime: Int32
```
功能： 应用实际申请的短时任务时间，单位为毫秒。短时任务申请时间最长为3分钟，低电量时最长为1分钟。
Type: Int32; Readable: true; Writable: false

#### let requestId

```cangjie
public let requestId: Int32
```
功能： 短时任务的请求ID。
Type: Int32; Readable: true; Writable: false



## Enums

### BackgroundMode

enum BackgroundMode
```cangjie
public enum BackgroundMode { | DATA_TRANSFER | AUDIO_PLAYBACK | AUDIO_RECORDING | LOCATION | BLUETOOTH_INTERACTION | MULTI_DEVICE_CONNECTION | VOIP | TASK_KEEPING | ... }
```
功能： 长时任务模式。

#### AUDIO_PLAYBACK

```cangjie
AUDIO_PLAYBACK
```
功能： 音频播放。

#### AUDIO_RECORDING

```cangjie
AUDIO_RECORDING
```
功能： 录音。

#### BLUETOOTH_INTERACTION

```cangjie
BLUETOOTH_INTERACTION
```
功能： 蓝牙相关。

#### DATA_TRANSFER

```cangjie
DATA_TRANSFER
```
功能： 数据传输。

#### LOCATION

```cangjie
LOCATION
```
功能： 定位导航。

#### MULTI_DEVICE_CONNECTION

```cangjie
MULTI_DEVICE_CONNECTION
```
功能： 多设备互联。

#### TASK_KEEPING

```cangjie
TASK_KEEPING
```
功能： 计算任务（仅对特定设备开放）。

#### VOIP

```cangjie
VOIP
```
功能： 音视频通话，此接口为系统接口。



