# ohos.user_auth（用户认证）

提供用户认证能力，可应用于设备解锁、支付、应用登录等身份认证场景。

```cangjie
import kit.UserAuthenticationKit.*
```
## Functions

### public func getAvailableStatus(authType: UserAuthType, authTrustLevel: AuthTrustLevel): Unit

```cangjie
public func getAvailableStatus(authType: UserAuthType, authTrustLevel: AuthTrustLevel): Unit
```
功能： 查询指定类型和等级的认证能力是否支持。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| UserAuthType | 是 | 认证类型。 | authType | - |
| AuthTrustLevel | 是 | 认证信任等级。 | authTrustLevel | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 用户认证错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission verification failed. |
| 401 | Incorrect parameters. Possible causes: 1.Mandatory parameters are left unspecified. |
| 12500002 | General operation error. |
| 12500005 | The authentication type is not supported. |
| 12500006 | The authentication trust level is not supported. |
| 12500010 | The type of credential has not been enrolled. |
| 12500013 | Operation failed because of PIN expired. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.UserAuthenticationKit.*

getAvailableStatus(UserAuthType.FACE, AuthTrustLevel.ATL1)
```

### public func getEnrolledState(authType: UserAuthType): EnrolledState

```cangjie
public func getEnrolledState(authType: UserAuthType): EnrolledState
```
功能： 查询凭据注册的状态，用于感知用户注册凭据变化。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| UserAuthType | 是 | 认证类型。 | authType | - |

**Returns:**

| type | description |
| --- | --- |
| EnrolledState | 当查询成功时，返回用户注册凭据的状态。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 用户认证错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission verification failed. |
| 401 | Incorrect parameters. Possible causes: 1.Mandatory parameters are left unspecified. |
| 12500002 | General operation error. |
| 12500005 | The authentication type is not supported. |
| 12500010 | The type of credential has not been enrolled. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.UserAuthenticationKit.*

let res = getEnrolledState(UserAuthType.FACE)
```

### public func getUserAuthInstance(authParam: AuthParam, widgetParam: WidgetParam): UserAuthInstance

```cangjie
public func getUserAuthInstance(authParam: AuthParam, widgetParam: WidgetParam): UserAuthInstance
```
功能： 获取 UserAuthInstance 对象，用于执行用户身份认证，并支持使用统一用户身份认证控件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| AuthParam | 是 | 用户认证相关参数。 | authParam | - |
| WidgetParam | 是 | 用户认证界面配置相关参数。 | widgetParam | - |

**Returns:**

| type | description |
| --- | --- |
| UserAuthInstance | 支持用户界面的认证器对象。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 用户认证错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | Incorrect parameters. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed. |
| 12500002 | General operation error. |
| 12500005 | The authentication type is not supported. |
| 12500006 | The authentication trust level is not supported. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.UserAuthenticationKit.*

let userAuthInstance = getUserAuthInstance (
 AuthParam([], [UserAuthType.FACE], AuthTrustLevel.ATL1),
 WidgetParam("TEST FACE_ATL1", "")
)
```


## Classes

### AuthParam

class AuthParam
```cangjie
public class AuthParam { public AuthParam( public let challenge: Array<Byte>, public let authType: Array<UserAuthType>, public let authTrustLevel: AuthTrustLevel, public let reuseUnlockResult!: ?ReuseUnlockResult = Option.None ) }
```
功能： 用户认证相关参数。

#### let authTrustLevel

```cangjie
public let authTrustLevel: AuthTrustLevel
```
功能： 认证信任等级。
Type: AuthTrustLevel; Readable: true; Writable: false

#### let authType

```cangjie
public let authType: Array<UserAuthType>
```
功能： 认证类型列表，用来指定用户认证界面提供的认证方法。
Type: Array< UserAuthType >; Readable: true; Writable: false

#### let challenge

```cangjie
public let challenge: Array<Byte>
```
功能： 挑战值，用来防重放攻击。最大长度为32字节，可传Array[]。
Type: Array<Byte>; Readable: true; Writable: false

#### let reuseUnlockResult

```cangjie
public let reuseUnlockResult: ?ReuseUnlockResult = Option.None
```
功能： 表示可以复用设备解锁结果。
Type: ? ReuseUnlockResult; Readable: true; Writable: false


### EnrolledState

class EnrolledState
```cangjie
public class EnrolledState { public let credentialDigest: UInt64 public let credentialCount: UInt16 }
```
功能： 表示用户注册凭据的状态。

#### let credentialCount

```cangjie
public let credentialCount: UInt16
```
功能： 注册的凭据数量。
Type: UInt16; Readable: true; Writable: false

#### let credentialDigest

```cangjie
public let credentialDigest: UInt64
```
功能： 注册的凭据摘要，在凭据增加时随机生成。
Type: UInt64; Readable: true; Writable: false


### ReuseUnlockResult

class ReuseUnlockResult
```cangjie
public class ReuseUnlockResult { public ReuseUnlockResult( public let reuseMode: ReuseMode, public let reuseDuration: UInt64 ) }
```
功能： 表示复用设备解锁结果。

#### let reuseDuration

```cangjie
public let reuseDuration: UInt64
```
功能： 允许复用设备解锁结果的有效时长，有效时长的值应大于0，最大值为300000ms。
Type: UInt64; Readable: true; Writable: false

#### let reuseMode

```cangjie
public let reuseMode: ReuseMode
```
功能： 复用设备解锁结果的模式。
Type: ReuseMode; Readable: true; Writable: false


### UserAuthInstance

class UserAuthInstance
```cangjie
public class UserAuthInstance {}
```
功能： 用于执行用户身份认证，并支持使用统一用户身份认证控件。


### UserAuthResult

class UserAuthResult
```cangjie
public class UserAuthResult {}
```
功能： 用户认证结果。当认证结果为成功时，返回认证类型和认证通过的令牌信息。

#### let authType

```cangjie
public let authType: ?UserAuthType
```
功能： 当认证结果为成功时，返回认证类型。
Type: ? UserAuthType; Readable: true; Writable: false

#### let enrolledState

```cangjie
public let enrolledState: ?EnrolledState
```
功能： 当认证结果为成功时，返回注册凭据的状态。
Type: ? EnrolledState; Readable: true; Writable: false

#### let result

```cangjie
public let result: Int32
```
功能： 用户认证结果。若成功返回SUCCESS，若失败返回相应错误码，参见 UserAuthResultCode 。
Type: Int32; Readable: true; Writable: false

#### let token

```cangjie
public let token: ?Array<Byte>
```
功能： 当认证结果为成功时，返回认证通过的令牌信息。
Type: ?Array<Byte>; Readable: true; Writable: false


### WidgetParam

class WidgetParam
```cangjie
public class WidgetParam { public WidgetParam( public let title: String, public let navigationButtonText: ?String ) }
```
功能： 用户认证界面配置相关参数。

#### let navigationButtonText

```cangjie
public let navigationButtonText: ?String
```
功能： 导航按键的说明文本，最大长度为60字符。仅在单指纹、单人脸场景下支持。
Type: ?String; Readable: true; Writable: false

#### let title

```cangjie
public let title: String
```
功能： 用户认证界面的标题，最大长度为500字符。
Type: String; Readable: true; Writable: false


### UserAuthResultCode

class UserAuthResultCode
```cangjie
public class UserAuthResultCode { public static const OHOS_CHECK_PERMISSION_FAILED: Int32 = 201 public static const OHOS_CHECK_SYSTEM_APP_FAILED: Int32 = 202 public static const OHOS_INVALID_PARAM: Int32 = 401 public static const SUCCESS: Int32 = 12500000 public static const FAIL: Int32 = 12500001 public static const GENERAL_ERROR: Int32 = 12500002 public static const CANCELED: Int32 = 12500003 public static const TIMEOUT: Int32 = 12500004 public static const TYPE_NOT_SUPPORT: Int32 = 12500005 public static const TRUST_LEVEL_NOT_SUPPORT: Int32 = 12500006 public static const BUSY: Int32 = 12500007 public static const LOCKED: Int32 = 12500009 public static const NOT_ENROLLED: Int32 = 12500010 public static const CANCELED_FROM_WIDGET: Int32 = 12500011 public static const HARDWARE_NOT_SUPPORTED: Int32 = 12500012 public static const PIN_EXPIRED: Int32 = 12500013 }
```
功能： 表示返回码。



## Enums

### AuthTrustLevel

enum AuthTrustLevel
```cangjie
public enum AuthTrustLevel { | ATL1 | ATL2 | ATL3 | ATL4 | ... }
```
功能： 表示认证结果的信任等级枚举。

#### ATL1

```cangjie
ATL1
```
功能： 认证结果的信任等级级别1，代表该认证方案能够识别用户个体，有一定的活体检测能力。常用的业务场景有业务风控、一般个人数据查询等。

#### ATL2

```cangjie
ATL2
```
功能： 认证结果的信任等级级别2，代表该认证方案能够精确识别用户个体，有一定的活体检测能力。常用的业务场景有维持设备解锁状态，应用登录等。

#### ATL3

```cangjie
ATL3
```
功能： 认证结果的信任等级级别3，代表该认证方案能够精确识别用户个体，有较强的活体检测能力。常用的业务场景有设备解锁等。

#### ATL4

```cangjie
ATL4
```
功能： 认证结果的信任等级级别4，代表该认证方案能够高精度的识别用户个体，有很强的活体检测能力。常用的业务场景有小额支付等。


### ReuseMode

enum ReuseMode
```cangjie
public enum ReuseMode { | AUTH_TYPE_RELEVANT | AUTH_TYPE_IRRELEVANT | ... }
```
功能： 表示复用设备解锁结果的模式。

#### AUTH_TYPE_IRRELEVANT

```cangjie
AUTH_TYPE_IRRELEVANT
```
功能： 与认证类型无关，只要解锁认证结果在有效时间内，就可以重复使用。

#### AUTH_TYPE_RELEVANT

```cangjie
AUTH_TYPE_RELEVANT
```
功能： 与认证类型相关，只有当设备解锁结果在有效时间内，并且设备解锁的认证类型匹配上本次认证指定认证类型之一时，可以复用该结果。


### UserAuthType

enum UserAuthType
```cangjie
public enum UserAuthType { | PIN | FACE | FINGERPRINT | ... }
```
功能： 表示身份认证的凭据类型枚举。

#### FACE

```cangjie
FACE
```
功能： 人脸认证。

#### FINGERPRINT

```cangjie
FINGERPRINT
```
功能： 指纹认证。

#### PIN

```cangjie
PIN
```
功能： 口令认证。



