# ohos.work_scheduler（延迟任务调度）

本模块提供延迟任务注册、取消、查询的能力。在开发过程中，对于实时性要求不高的任务，可以调用本模块接口注册延迟任务，在系统空闲时根据性能、功耗、热等情况进行调度执行。

```cangjie
import kit.BackgroundTasksKit.*
```
## Functions

### public func getWorkStatus(workId: Int32): WorkInfo

```cangjie
public func getWorkStatus(workId: Int32): WorkInfo
```
功能： 通过workId获取延迟任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 延迟任务Id。 | workId | - |

**Returns:**

| type | description |
| --- | --- |
| WorkInfo | 如果workId有效，则返回从WorkSchedulerService获取的任务，否则抛出异常。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 。

| code | description |
| --- | --- |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |
| 9700004 | Check workInfo failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

try{
 let workInfo = getWorkStatus(50)
 AppLog.info('workschedulerLog getWorkStatus success')
} catch (e: BusinessException) {
 AppLog.error('workschedulerLog getWorkStatus failed. code is ${e.code} message is ${e.message}')
}
```

### public func isLastWorkTimeOut(workId: Int32): Bool

```cangjie
public func isLastWorkTimeOut(workId: Int32): Bool
```
功能： 检查延迟任务的最后一次执行是否超时。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int32 | 是 | 指定延迟任务的Id。 | workId | - |

**Returns:**

| type | description |
| --- | --- |
| Bool | 返回true表示指定任务的最后一次执行超时，false表示未超时。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 。

| code | description |
| --- | --- |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |
| 9700004 | Check workInfo failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

try{
 let timeout = isLastWorkTimeOut(500)
 AppLog.info('workschedulerLog isLastWorkTimeOut success. timeout = ${timeout}')
 } catch (e: BusinessException) {
 AppLog.error('workschedulerLog isLastWorkTimeOut failed. code is ${e.code} message is ${e.message}')
}
```

### public func obtainAllWorks(): Array<WorkInfo>

```cangjie
public func obtainAllWorks(): Array<WorkInfo>
```
功能： 获取当前应用所有的延迟任务。

**Returns:**

| type | description |
| --- | --- |
| Array< WorkInfo > | 返回当前应用所有的延迟任务。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 .

| code | description |
| --- | --- |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

try{
 let works = obtainAllWorks()
 AppLog.info('workschedulerLog obtainAllWorks success. work size = ${works.size}')
} catch (e: BusinessException) {
 AppLog.error('workschedulerLog obtainAllWorks failed. code is ${e.code} message is ${e.message}')
}
```

### public func startWork(work: WorkInfo): Unit

```cangjie
public func startWork(work: WorkInfo): Unit
```
功能： 申请延迟任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| WorkInfo | 是 | 要添加到执行队列的延迟任务。 | work | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 。

| code | description |
| --- | --- |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |
| 9700004 | Check workInfo failed. |
| 9700005 | StartWork failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*
import kit.AbilityKit.*

let workInfo = WorkInfo(
 1,
 "com.example.myapplication",
 "MyExtension",
 batteryStatus: BatteryStatus.BATTERY_STATUS_LOW,
 isRepeat: false,
 isPersisted: true)

startWork(workInfo)
```

### public func stopAndClearWorks(): Unit

```cangjie
public func stopAndClearWorks(): Unit
```
功能： 停止和取消当前应用所有的延迟任务。

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameters types. |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

let workInfo = WorkInfo(
 1,
 "com.example.myapplication",
 "MyExtension",
 batteryStatus: BatteryStatus.BATTERY_STATUS_LOW,
 isRepeat: false,
 isPersisted: true
)

try{
 startWork(workInfo)
 stopAndClearWorks()
 AppLog.info('stopAndClearWorks success')
} catch (e: BusinessException) {
 AppLog.error('stopAndClearWorks failed. code is ${e.code} message is ${e.message}')
}
```

### public func stopWork(work: WorkInfo, needCancel!: Bool = false): Unit

```cangjie
public func stopWork(work: WorkInfo, needCancel!: Bool = false): Unit
```
功能： 取消延迟任务。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| WorkInfo | 是 | 要停止或移除的延迟任务。 | work | - |
| Bool | 否 | 命名参数。 是否需要移除的任务。 - true表示停止并移除。 - false表示只停止不移除。 默认为false。 | needCancel | false |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 workScheduler错误码 。

| code | description |
| --- | --- |
| 9700001 | Memory operation failed. |
| 9700002 | Parcel operation failed. |
| 9700003 | System service operation failed. |
| 9700004 | Check workInfo failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.BackgroundTasksKit.*

let workInfo = WorkInfo(
 1,
 "com.example.myapplication",
 "MyExtension",
 batteryStatus: BatteryStatus.BATTERY_STATUS_LOW,
 isRepeat: false,
 isPersisted: true
)

try{
 stopWork(workInfo, needCancel: false)
 AppLog.info("workschedulerLog stopWork success")
} catch (e: Exception) {
 AppLog.error("workschedulerLog stopWork failed. message: ${e.toString()}")
}
```


## Classes

### WorkInfo

class WorkInfo
```cangjie
public class WorkInfo { public var workId: Int32 public var bundleName: String public var abilityName: String public var netWorkType: ?NetworkType = None public var isCharging: ?Bool = None public var chargerType: ?ChargingType = None public var batteryLevel: ?Int32 = None public var batteryStatus: ?BatteryStatus = None public var storageRequest: ?StorageRequest = None public var isRepeat: ?Bool = None public var repeatCycleTime: ?Int32 = None public var repeatCount: ?Int32 = None public var isPersisted: ?Bool = None public var isDeepIdle: ?Bool = None public var idleWaitTime: ?Int32 = None public var parameters: HashMap<String, WorkSchedulerValueType> = HashMap<String, WorkSchedulerValueType>() public init( workId: Int32, bundleName: String, abilityName: String, netWorkType!: ?NetworkType = None, isCharging!: ?Bool = None, chargerType!: ?ChargingType = None, batteryLevel!: ?Int32 = None, batteryStatus!: ?BatteryStatus = None, storageRequest!: ?StorageRequest = None, isRepeat!: ?Bool = None, repeatCycleTime!: ?Int32 = None, repeatCount!: ?Int32 = None, isPersisted!: ?Bool = None, isDeepIdle!: ?Bool = None, idleWaitTime!: ?Int32 = None ) public init( workId: Int32, bundleName: String, abilityName: String, parameters: HashMap<String, WorkSchedulerValueType>, netWorkType!: ?NetworkType = None, isCharging!: ?Bool = None, chargerType!: ?ChargingType = None, batteryLevel!: ?Int32 = None, batteryStatus!: ?BatteryStatus = None, storageRequest!: ?StorageRequest = None, isRepeat!: ?Bool = None, repeatCycleTime!: ?Int32 = None, repeatCount!: ?Int32 = None, isPersisted!: ?Bool = None, isDeepIdle!: ?Bool = None, idleWaitTime!: ?Int32 = None ) }
```
功能： 延迟任务具体信息。

#### var abilityName

```cangjie
public var abilityName: String
```
功能： 包内ability名称。
Type: String; Readable: true; Writable: true

#### var batteryLevel

```cangjie
public var batteryLevel: ?Int32 = None
```
功能： 电量。
Type: ?Int32; Readable: true; Writable: true

#### var batteryStatus

```cangjie
public var batteryStatus: ?BatteryStatus = None
```
功能： 电池状态。
Type: ?BatteryStatus; Readable: true; Writable: true

#### var bundleName

```cangjie
public var bundleName: String
```
功能： 延迟任务包名。
Type: String; Readable: true; Writable: true

#### var chargerType

```cangjie
public var chargerType: ?ChargingType = None
```
功能： 充电类型。
Type: ?ChargingType; Readable: true; Writable: true

#### var idleWaitTime

```cangjie
public var idleWaitTime: ?Int32 = None
```
功能： 空闲等待时间，单位为毫秒。
Type: ?Int32; Readable: true; Writable: true

#### var isCharging

```cangjie
public var isCharging: ?Bool = None
```
功能： 是否充电。 - true表示充电触发延迟回调。 - false表示不充电触发延迟回调。
Type: ?Bool; Readable: true; Writable: true

#### var isDeepIdle

```cangjie
public var isDeepIdle: ?Bool = None
```
功能： 是否要求设备进入空闲状态。 - true表示需要。 - false表示不需要。
Type: ?Bool; Readable: true; Writable: true

#### var isPersisted

```cangjie
public var isPersisted: ?Bool = None
```
功能： 注册的延迟任务是否可保存在系统中。 - true表示可保存，即系统重启后。 - false表示不可保存。
Type: ?Bool; Readable: true; Writable: true

#### var isRepeat

```cangjie
public var isRepeat: ?Bool = None
```
功能： 是否循环任务。 - true表示循环任务。 - false表示非循环任务。
Type: ?Bool; Readable: true; Writable: true

#### var netWorkType

```cangjie
public var netWorkType: ?NetworkType = None
```
功能： 网络类型。
Type: ? NetworkType; Readable: true; Writable: true

#### var parameters

```cangjie
public var parameters: HashMap<String, WorkSchedulerValueType> = HashMap<String, WorkSchedulerValueType>()
```
功能： 携带参数信息。
Type: HashMap<String, WorkSchedulerValueType >; Readable: true; Writable: true

#### var repeatCount

```cangjie
public var repeatCount: ?Int32 = None
```
功能： 循环次数。
Type: ?Int32; Readable: true; Writable: true

#### var repeatCycvarime

```cangjie
public var repeatCycvarime: ?Int32 = None
```
功能： 循环间隔，单位为毫秒。
Type: ?Int32; Readable: true; Writable: true

#### var storageRequest

```cangjie
public var storageRequest: ?StorageRequest = None
```
功能： 存储状态。
Type: ? StorageRequest; Readable: true; Writable: true

#### var workId

```cangjie
public var workId: Int32
```
功能： 延迟任务ID。
Type: Int32; Readable: true; Writable: true



## Enums

### BatteryStatus

enum BatteryStatus
```cangjie
public enum BatteryStatus { | BATTERY_STATUS_LOW | BATTERY_STATUS_OKAY | BATTERY_STATUS_LOW_OR_OKAY |... }
```
功能： 触发延迟回调的电池状态。

#### BATTERY_STATUS_LOW

```cangjie
BATTERY_STATUS_LOW
```
功能： 表示这个触发条件是低电告警。

#### BATTERY_STATUS_LOW_OR_OKAY

```cangjie
BATTERY_STATUS_LOW_OR_OKAY
```
功能： 表示这个触发条件是从低电恢复到正常电量或者低电告警。

#### BATTERY_STATUS_OKAY

```cangjie
BATTERY_STATUS_OKAY
```
功能： 表示这个触发条件是从低电恢复到正常电量。


### ChargingType

enum ChargingType
```cangjie
public enum ChargingType { | CHARGING_PLUGGED_ANY | CHARGING_PLUGGED_AC | CHARGING_PLUGGED_USB | CHARGING_PLUGGED_WIRELESS |... }
```
功能： 触发延迟回调的充电类型。

#### CHARGING_PLUGGED_AC

```cangjie
CHARGING_PLUGGED_AC
```
功能： 表示这个触发条件是直流充电器连接。

#### CHARGING_PLUGGED_ANY

```cangjie
CHARGING_PLUGGED_ANY
```
功能： 表示这个触发条件是任何类型的充电器连接。

#### CHARGING_PLUGGED_USB

```cangjie
CHARGING_PLUGGED_USB
```
功能： 表示这个触发条件是USB充连接。

#### CHARGING_PLUGGED_WIRELESS

```cangjie
CHARGING_PLUGGED_WIRELESS
```
功能： 表示这个触发条件是无线充电器连接。


### NetworkType

enum NetworkType
```cangjie
public enum NetworkType { | NETWORK_TYPE_ANY | NETWORK_TYPE_MOBILE | NETWORK_TYPE_WIFI | NETWORK_TYPE_BLUETOOTH | NETWORK_TYPE_WIFI_P2P | NETWORK_TYPE_ETHERNET |... }
```
功能： 触发延迟回调的网络类型。

#### NETWORK_TYPE_ANY

```cangjie
NETWORK_TYPE_ANY
```
功能： 表示这个触发条件是任何类型的网络连接。

#### NETWORK_TYPE_BLUETOOTH

```cangjie
NETWORK_TYPE_BLUETOOTH
```
功能： 表示这个触发条件是Bluetooth网络连接。

#### NETWORK_TYPE_ETHERNET

```cangjie
NETWORK_TYPE_ETHERNET
```
功能： 表示这个触发条件是有线网络连接。

#### NETWORK_TYPE_MOBILE

```cangjie
NETWORK_TYPE_MOBILE
```
功能： 表示这个触发条件是Mobile网络连接。

#### NETWORK_TYPE_WIFI

```cangjie
NETWORK_TYPE_WIFI
```
功能： 表示这个触发条件是Wifi类型的网络连接。

#### NETWORK_TYPE_WIFI_P2P

```cangjie
NETWORK_TYPE_WIFI_P2P
```
功能： 表示这个触发条件是Wifi P2P网络连接。


### StorageRequest

enum StorageRequest
```cangjie
public enum StorageRequest { | STORAGE_LEVEL_LOW | STORAGE_LEVEL_OKAY | STORAGE_LEVEL_LOW_OR_OKAY |... }
```
功能： 触发延迟回调的存储状态。

#### STORAGE_LEVEL_LOW

```cangjie
STORAGE_LEVEL_LOW
```
功能： 表示这个触发条件是存储空间不足。

#### STORAGE_LEVEL_LOW_OR_OKAY

```cangjie
STORAGE_LEVEL_LOW_OR_OKAY
```
功能： 表示这个触发条件是存储空间不足或者从存储空间不足恢复到正常。

#### STORAGE_LEVEL_OKAY

```cangjie
STORAGE_LEVEL_OKAY
```
功能： 表示这个触发条件是从存储空间不足恢复到正常。


### WorkSchedulerValueType

enum WorkSchedulerValueType
```cangjie
public enum WorkSchedulerValueType <: Equatable<WorkSchedulerValueType> & ToString { | INT(Int32) | FLOAT64(Float64) | BOOL(Bool) | STRING(String) |... }
```
功能： 类型用于表示参数信息中允许的数据字段类型。

#### BOOL(Bool)

```cangjie
BOOL(Bool)
```
功能： 表示字段类型为布尔值。

#### FLOAT64(Float64)

```cangjie
FLOAT64(Float64)
```
功能： 表示字段类型为浮点数。

#### INT(Int32)

```cangjie
INT(Int32)
```
功能： 表示字段类型为整型数。

#### STRING(String)

```cangjie
STRING(String)
```
功能： 表示字段类型为字符串。



