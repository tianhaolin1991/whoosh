# 自定义手势判定

为组件提供自定义手势判定能力。开发者可根据需要，在手势识别期间，决定是否响应手势。

## Functions

### public func onGestureJudgeBegin(callback: (GestureInfo, BaseGestureEvent) -> GestureJudgeResult): This

```cangjie
public func onGestureJudgeBegin(callback: (GestureInfo, BaseGestureEvent) -> GestureJudgeResult): This
```
功能： 给组件绑定自定义手势判定回调，当绑定到该组件的手势被接受时，会触发用户定义的回调来获取结果。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( GestureInfo , BaseGestureEvent )-> GestureJudgeResult | 是 | 给组件绑定自定义手势判定回调，当绑定到该组件的手势被接受时，会触发用户定义的回调来获取结果。 | callback | - |


## Classes

### BaseEvent

class BaseEvent
```cangjie
public open class BaseEvent { public let target: EventTarget, public let timestamp: Int64, public let source: SourceType, public let pressure: Float64, public let tiltX: Int64, public let tiltY: Int64, public let sourceTool: SourceTool, public let axisHorizontal: Option<Float32>, public let axisVertical: Option<Float32>, public let getModifierKeyState: Option<(Array<String>) -> Bool>, public let deviceId: Int64 }
```
功能： 基础事件信息基类。

#### let axisHorizontal

```cangjie
public let axisHorizontal: Option<Float32>
```
功能： 水平轴值。
Type: Option<Float32>; Readable: true; Writable: false

#### let axisVertical

```cangjie
public let axisVertical: Option<Float32>
```
功能： 垂直轴值。
Type: Option<Float32>; Readable: true; Writable: false

#### let deviceId

```cangjie
public let deviceId: Int64
```
功能： 触发当前事件的输入设备ID。
Type: Int64; Readable: true; Writable: false

#### let getModifierKeyState

```cangjie
public let getModifierKeyState: Option <(Array<String>) -> Bool>
```
功能： 获取功能键按压状态。报错信息请参考以下错误码。支持功能键 'Ctrl'|'Alt'|'Shift'|'Fn'，设备外接带Fn键的键盘不支持Fn键查询。
Type: Option<(Array<String>)->Bool>; Readable: true; Writable: false

#### let pressure

```cangjie
public let pressure: Float64
```
功能： 按压的压力大小。
Type: Float64; Readable: true; Writable: false

#### let source

```cangjie
public let source: SourceType
```
功能： 事件输入设备。
Type: SourceType; Readable: true; Writable: false

#### let sourceTool

```cangjie
public let sourceTool: SourceTool
```
功能： 事件输入源。
Type: SourceTool; Readable: true; Writable: false

#### let target

```cangjie
public let target: EventTarget
```
功能： 手势标记。
Type: EventTarget; Readable: true; Writable: false

#### let tiltX

```cangjie
public let tiltX: Int64
```
功能： 手写笔在设备平面上的投影与设备平面X轴的夹角。
Type: Int64; Readable: true; Writable: false

#### let tiltY

```cangjie
public let tiltY: Int64
```
功能： 手写笔在设备平面上的投影与设备平面Y轴的夹角。
Type: Int64; Readable: true; Writable: false

#### let timestamp

```cangjie
public let timestamp: Int64
```
功能： 事件时间戳。
Type: Int64; Readable: true; Writable: false


### BaseGestureEvent

class BaseGestureEvent
```cangjie
public open class BaseGestureEvent <: BaseEvent { public let fingerList: ArrayList<FingerInfo> }
```
功能： 基础手势事件信息的基类。

#### let fingerList

```cangjie
public let fingerList: ArrayList<FingerInfo>
```
功能： 触发事件的所有手指信息。
Type: ArrayList< FingerInfo >; Readable: true; Writable: false


### LongPressGestureEvent

class LongPressGestureEvent
```cangjie
public class LongPressGestureEvent <: BaseGestureEvent { public let repeat: Bool }
```
功能： 长按手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。

#### let repeat

```cangjie
public let repeat: Bool
```
功能： 是否为重复触发事件。
Type: Bool; Readable: true; Writable: false


### PanGestureEvent

class PanGestureEvent
```cangjie
public class PanGestureEvent <: BaseGestureEvent { public let offsetX: Float64 public let offsetY: Float64 public let velocityX: Float64 public let velocityY: Float64 public let velocity: Float64 }
```
功能： 滑动手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。

#### let offsetX

```cangjie
public let offsetX: Float64
```
功能： 手势事件偏移量X，单位为vp，从左向右滑动offsetX为正，反之为负。
Type: Float64; Readable: true; Writable: false

#### let offsetY

```cangjie
public let offsetY: Float64
```
功能： 手势事件偏移量Y，单位为vp，从上向下滑动offsetY为正，反之为负。
Type: Float64; Readable: true; Writable: false

#### let velocity

```cangjie
public let velocity: Float64
```
功能： 获取当前手势的主方向速度。为xy轴方向速度的平方和的算术平方根。单位为vp/s。
Type: Float64; Readable: true; Writable: false

#### let velocityX

```cangjie
public let velocityX: Float64
```
功能： 获取当前手势的x轴方向速度。坐标轴原点为屏幕左上角，分正负方向速度，从左往右为正，反之为负。单位为vp/s。
Type: Float64; Readable: true; Writable: false

#### let velocityY

```cangjie
public let velocityY: Float64
```
功能： 获取当前手势的y轴方向速度。坐标轴原点为屏幕左上角，分正负方向速度，从上往下为正，反之为负。单位为vp/s。
Type: Float64; Readable: true; Writable: false


### PinchGestureEvent

class PinchGestureEvent
```cangjie
public class PinchGestureEvent <: BaseGestureEvent { public let scale: Float64 public let pinchCenterX: Float64 public let pinchCenterY: Float64 }
```
功能： 捏合手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。

#### let pinchCenterX

```cangjie
public let pinchCenterX: Float64
```
功能： 捏合手势中心点相对于当前组件元素原始区域左上角x轴坐标，单位为vp。
Type: Float64; Readable: true; Writable: false

#### let pinchCenterY

```cangjie
public let pinchCenterY: Float64
```
功能： 捏合手势中心点相对于当前组件元素原始区域左上角y轴坐标，单位为vp。
Type: Float64; Readable: true; Writable: false

#### let scale

```cangjie
public let scale: Float64
```
功能： 缩放比例。
Type: Float64; Readable: true; Writable: false


### RotationGestureEvent

class RotationGestureEvent
```cangjie
public class RotationGestureEvent <: BaseGestureEvent { public let angle: Float64 }
```
功能： 旋转手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。

#### let angle

```cangjie
public let angle: Float64
```
功能： 表示旋转角度，单位为deg。以起始线条为坐标系，顺时针旋转为0到180度，逆时针旋转为-180到0度。
Type: Float64; Readable: true; Writable: false


### SwipeGestureEvent

class SwipeGestureEvent
```cangjie
public class SwipeGestureEvent <: BaseGestureEvent { public let angle: Float64 public let speed: Float64 }
```
功能： swipe手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。

#### let angle

```cangjie
public let angle: Float64
```
功能： 表示滑动手势的角度，即两根手指间的线段与水平方向的夹角变化的度数，单位为deg。以起始线条为坐标系，顺时针旋转为0到180度，逆时针旋转为-180到0度。
Type: Float64; Readable: true; Writable: false

#### let speed

```cangjie
public let speed: Float64
```
功能： 滑动手势速度，即所有手指相对当前组件元素原始区域滑动的平均速度，单位为vp/s。
Type: Float64; Readable: true; Writable: false


### TapGestureEvent

class TapGestureEvent
```cangjie
public class TapGestureEvent <: BaseGestureEvent {}
```
功能： 点击手势的基础手势事件信息，可将该对象作为onGestureJudgeBegin的event参数来传递。


### GestureInfo

class GestureInfo
```cangjie
public class GestureInfo { public let tag: String, public let `type`: GestureTypes, }
```
功能： 手势基础信息。

#### let type

```cangjie
public let `type`: GestureTypes
```
功能： 手势类型。
Type: GestureTypes; Readable: true; Writable: false

#### let isSystemGesture

```cangjie
public let isSystemGesture: Bool
```
功能： 判断当前手势是否是组件自带的手势。
Type: Bool; Readable: true; Writable: false

#### let tag

```cangjie
public let tag: String
```
功能： 手势标记。
Type: String; Readable: true; Writable: false



## Enums

### GestureTypes

enum GestureTypes
```cangjie
public enum GestureTypes { | TAP_GESTURE | LONG_PRESS_GESTURE | PAN_GESTURE | PINCH_GESTURE | SWIPE_GESTURE | ROTATION_GESTURE | DRAG | CLICK }
```
功能： 手势类型。

#### CLICK

```cangjie
CLICK
```
功能： 点击。

#### DRAG

```cangjie
DRAG
```
功能： 拖拽。

#### LONG_PRESS_GESTURE

```cangjie
LONG_PRESS_GESTURE
```
功能： 长按手势。

#### PAN_GESTURE

```cangjie
PAN_GESTURE
```
功能： 拖动手势。

#### PINCH_GESTURE

```cangjie
PINCH_GESTURE
```
功能： 捏合手势。

#### ROTATION_GESTURE

```cangjie
ROTATION_GESTURE
```
功能： 旋转手势。

#### SWIPE_GESTURE

```cangjie
SWIPE_GESTURE
```
功能： 滑动手势。

#### TAP_GESTURE

```cangjie
TAP_GESTURE
```
功能： 点击手势。


### GestureJudgeResult

enum GestureJudgeResult
```cangjie
public enum GestureJudgeResult { | CONTINUE | REJECT }
```
功能： 自定义的手势判定结果。

#### CONTINUE

```cangjie
CONTINUE
```
功能： 不影响系统手势判定流程。

#### REJECT

```cangjie
REJECT
```
功能： 对于用户自定义的手势判定结果为失败。



## Examples

```cangjie
package ohos_app_cangjie_entry

import kit.UIKit.*
import ohos.state_macro_manage.*

@Entry
@Component
class EntryView {
 @State var message: String = ""

 func build() {
 Column() {
 Row() {
 Text(message).width(200).height(80).backgroundColor(Color.GRAY)
 }
 .margin(20.vp)
 }
 .width(100.percent)
 .height(200)
 .borderWidth(2)
 .gesture(
 TapGesture()
 .onAction({ evt =>
 message = "tap1"
 })
 )
 .gesture(
 LongPressGesture()
 .onAction({ evt =>
 message = "longPress"
 })
 )
 .gesture(
 SwipeGesture()
 .onAction({ evt =>
 message = "swipe1"
 })
 )
 .gesture(
 PanGesture()
 .onActionStart({ evt =>
 message = "pan1"
 })
 )
 .onGestureJudgeBegin({ gestureInfo: GestureInfo, event: BaseGestureEvent =>
 // 若该手势类型为长按手势，转换为长按手势事件
 if(event is LongPressGestureEvent) {
 let longPressEvent = (event as LongPressGestureEvent).getOrThrow()
 AppLog.info("repeat = ${longPressEvent.repeat}")
 }
 // 若该手势类型为滑动手势，转换为滑动手势事件
 if(event is SwipeGestureEvent) {
 let swipeGesture = (event as SwipeGestureEvent).getOrThrow()
 AppLog.info("angle = ${swipeGesture.angle }")
 }
 // 若该手势类型为拖动手势，转换为拖动手势事件
 if(event is PanGestureEvent) {
 let panGesture = (event as PanGestureEvent).getOrThrow()
 AppLog.info("velocity = ${panGesture.velocity }")
 }
 match(gestureInfo.`type`) {
 // 返回 REJECT 会使拖动手势失败
 case GestureTypes.PAN_GESTURE => return GestureJudgeResult.REJECT
 // 返回 CONTINUE 将保持系统判定。
 case _ => return GestureJudgeResult.CONTINUE
 }
 })
 }
}
```

