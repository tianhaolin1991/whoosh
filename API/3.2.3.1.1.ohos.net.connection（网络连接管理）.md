# ohos.net.connection（网络连接管理）

网络连接管理提供管理网络一些基础能力，包括获取默认激活的数据网络、获取所有激活数据网络列表、开启关闭飞行模式、获取网络能力信息等功能。

```cangjie
import kit.NetworkKit.*
```
## Functions

### public func createNetConnection(netSpecifier!: ?NetSpecifier = None, timeout!: UInt32 = 0): NetConnection

```cangjie
public func createNetConnection(netSpecifier!: ?NetSpecifier = None, timeout!: UInt32 = 0): NetConnection
```
功能： 创建一个NetConnection对象，netSpecifier指定关注的网络的各项特征；timeout是超时时间(单位是毫秒)；netSpecifier是timeout的必要条件，两者都没有则表示关注默认网络。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ? NetSpecifier | 否 | 命名参数。 指定网络的各项特征，为None时关注默认网络。 | netSpecifier | None |
| UInt32 | 否 | 命名参数。 获取netSpecifier指定的网络时的超时时间，仅netSpecifier存在时生效，默认值为0。 | timeout | 0 |

**Returns:**

| type | description |
| --- | --- |
| NetConnection | 所关注的网络的句柄。 |

**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

// 关注默认网络, 不需要传参
let netConnection = createNetConnection()

// 关注蜂窝网络，需要传入相关网络特征，timeout参数未传入说明未使用超时时间，此时timeout为0
let netspecifier = NetSpecifier(NetCapabilities([NetBearType.BEARER_CELLULAR]))
let netConnectionCellular = createNetConnection(netSpecifier: netspecifier)
```

### public func getAddressesByName(host: String): Array<NetAddress>

```cangjie
public func getAddressesByName(host: String): Array<NetAddress>
```
功能： 使用对应网络解析主机名以获取所有IP地址。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| String | 是 | 需要解析的主机名。 | host | - |

**Returns:**

| type | description |
| --- | --- |
| Array< NetAddress > | 返回所有IP地址。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let addresses = getAddressesByName("localhost")
```

### public func getAllNets(): Array<NetHandle>

```cangjie
public func getAllNets(): Array<NetHandle>
```
功能： 获取所有处于连接状态的网络列表。

**Returns:**

| type | description |
| --- | --- |
| Array< NetHandle > | 返回激活的数据网络列表。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let netHandles = getAllNets()
```

### public func getAppNet(): NetHandle

```cangjie
public func getAppNet(): NetHandle
```
功能： 绑定App到指定网络，绑定后的App只能通过指定网络访问外网。

**Returns:**

| type | description |
| --- | --- |
| NetHandle | 返回APP绑定的数据网络。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 401 | Parameter error. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let netHandle = getAppNet()
```

### public func getConnectionProperties(netHandle: NetHandle): ConnectionProperties

```cangjie
public func getConnectionProperties(netHandle: NetHandle): ConnectionProperties
```
功能： 获取netHandle对应的网络的连接信息。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NetHandle | 是 | 数据网络的句柄。 | netHandle | - |

**Returns:**

| type | description |
| --- | --- |
| ConnectionProperties | 返回网络的连接信息。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*
import kit.PerformanceAnalysisKit.*

try {
 let netHandle = getDefaultNet()
 let connectionProperties = getConnectionProperties(netHandle)
} catch (e: BusinessException) {
 Hilog.info(0, "test", "getConnectionProperties failed: ${e.code} ${e.message}")
}
```

### public func getDefaultHttpProxy(): HttpProxy

```cangjie
public func getDefaultHttpProxy(): HttpProxy
```
功能： 获取网络默认的代理配置信息。 如果设置了全局代理，则会返回全局代理配置信息。如果进程使用setAppNet绑定到指定NetHandle对应的网络，则返回NetHandle对应网络的代理配置信息。在其它情况下，将返回默认网络的代理配置信息。

**Returns:**

| type | description |
| --- | --- |
| HttpProxy | 返回网络默认的代理配置信息。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 。

| code | description |
| --- | --- |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*
import kit.PerformanceAnalysisKit.*

try {
 let proxy = getDefaultHttpProxy()
 Hilog.info(0, "test", "proxy: ${proxy.host ?? ""} ${proxy.port ?? 0}")
} catch (e: BusinessException) {
 Hilog.info(0, "test", "getDefaultHttpProxy failed: ${e.code} ${e.message}")
}
```

### public func getDefaultNet(): NetHandle

```cangjie
public func getDefaultNet(): NetHandle
```
功能： 获取默认激活的数据网络。可以使用getNetCapabilities去获取网络的类型、拥有的能力等信息。

**Returns:**

| type | description |
| --- | --- |
| NetHandle | 返回默认激活的数据网络。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let netHandle = getDefaultNet()
```

### public func getNetCapabilities(netHandle: NetHandle): NetCapabilities

```cangjie
public func getNetCapabilities(netHandle: NetHandle): NetCapabilities
```
功能： 获取netHandle对应的网络的能力信息。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NetHandle | 是 | 数据网络的句柄。 | netHandle | - |

**Returns:**

| type | description |
| --- | --- |
| NetCapabilities | 返回网络的能力信息。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*
import kit.PerformanceAnalysisKit.*

try {
 let netHandle = getDefaultNet()
 let netCapabilities = getNetCapabilities(netHandle)
} catch (e: BusinessException) {
 Hilog.info(0, "test", "getNetCapabilities failed: ${e.code} ${e.message}")
}
```

### public func hasDefaultNet(): Bool

```cangjie
public func hasDefaultNet(): Bool
```
功能： 检查默认数据网络是否被激活，返回接口，如果被激活则返回true。

**Returns:**

| type | description |
| --- | --- |
| Bool | 默认数据网络被激活返回true。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let hasDefault = hasDefaultNet()
```

### public func isDefaultNetMetered(): Bool

```cangjie
public func isDefaultNetMetered(): Bool
```
功能： 检查当前网络上的数据流量使用是否被计量。

**Returns:**

| type | description |
| --- | --- |
| Bool | 当前网络上的数据流量使用被计量，则返回true，否则返回false。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let isMetered = isDefaultNetMetered()
```

### public func reportNetConnected(netHandle: NetHandle): Unit

```cangjie
public func reportNetConnected(netHandle: NetHandle): Unit
```
功能： 向网络管理报告网络处于可用状态。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NetHandle | 是 | 数据网络的句柄，参考 NetHandle 。 | netHandle | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |
| 2101006 | the net id is not found. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let handle = getDefaultNet()
reportNetConnected(handle)
```

### public func reportNetDisconnected(netHandle: NetHandle): Unit

```cangjie
public func reportNetDisconnected(netHandle: NetHandle): Unit
```
功能： 向网络管理报告网络处于不可用状态。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NetHandle | 是 | 数据网络的句柄，参考 NetHandle 。 | netHandle | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |
| 2101006 | the net id is not found. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*

let handle = getDefaultNet()
reportNetDisconnected(handle)
```

### public func setAppNet(netHandle: NetHandle): Unit

```cangjie
public func setAppNet(netHandle: NetHandle): Unit
```
功能： 绑定App到指定网络，绑定后的App只能通过指定网络访问外网。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| NetHandle | 是 | 数据网络的句柄。 | netHandle | - |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 网络连接管理错误码 和 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Parameter error. |
| 2100001 | Invalid parameter value. |
| 2100002 | Operation failed. Cannot connect to service. |
| 2100003 | System internal error. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.NetworkKit.*
import kit.PerformanceAnalysisKit.*

try {
 let netHandle = getDefaultNet()
 setAppNet(netHandle)
} catch (e: BusinessException) {
 Hilog.info(0, "test", "setAppNet failed: ${e.code} ${e.message}")
}
```


## Classes

### ConnectionProperties

class ConnectionProperties
```cangjie
public class ConnectionProperties { public ConnectionProperties( public let interfaceName: String, public let domains: String, public let linkAddresses: Array<LinkAddress>, public let dnses: Array<NetAddress>, public let routes: Array<RouteInfo>, public let mtu: UInt16 ) }
```
功能： 网络连接信息类。

#### let dnses

```cangjie
public let dnses: Array<NetAddress>
```
功能： 网络地址，参考 NetAddress 。
Type: Array< NetAddress >; Readable: true; Writable: false

#### let domains

```cangjie
public let domains: String
```
功能： 所属域，默认""。
Type: String; Readable: true; Writable: false

#### let interfaceName

```cangjie
public let interfaceName: String
```
功能： 网卡名称。
Type: String; Readable: true; Writable: false

#### let linkAddresses

```cangjie
public let linkAddresses: Array<LinkAddress>
```
功能： 链路信息。
Type: Array< LinkAddress >; Readable: true; Writable: false

#### let mtu

```cangjie
public let mtu: UInt16
```
功能： 最大传输单元。
Type: UInt16; Readable: true; Writable: false

#### let routes

```cangjie
public let routes: Array<RouteInfo>
```
功能： 路由信息。
Type: Array< RouteInfo >; Readable: true; Writable: false


### HttpProxy

class HttpProxy
```cangjie
public class HttpProxy { public HttpProxy( public let host!: ?String = None, public let port!: ?UInt16 = None, public let exclusionList!: ?Array<String> = None ) }
```
功能： 网络代理配置信息。

#### let exclusionList

```cangjie
public let exclusionList: ?Array<String>= None
```
功能： 不使用代理的主机名列表，主机名支持域名、IP地址以及通配符形式，详细匹配规则如下：
Type: ?Array<String>; Readable: true; Writable: false

#### let host

```cangjie
public let host: ?String = None
```
功能： 代理服务器主机名。
Type: ?String; Readable: true; Writable: false

#### let port

```cangjie
public let port: ?UInt16 = None
```
功能： 主机端口。
Type: ?UInt16; Readable: true; Writable: false


### LinkAddress

class LinkAddress
```cangjie
public class LinkAddress { public LinkAddress( public let address: NetAddress, public let prefixLength: Int32 ) }
```
功能： 网络链路信息。

#### let address

```cangjie
public let address: NetAddress
```
功能： 链路地址。
Type: NetAddress; Readable: true; Writable: false

#### let prefixLength

```cangjie
public let prefixLength: Int32
```
功能： 链路地址前缀的长度。
Type: Int32; Readable: true; Writable: false


### NetAddress

class NetAddress
```cangjie
public class NetAddress { public NetAddress( public let address: String, public let family: ?UInt32, public let port: ?UInt16 ) }
```
功能： 网络地址。

#### let address

```cangjie
public let address: String
```
功能： 地址。
Type: String; Readable: true; Writable: false

#### let family

```cangjie
public let family: ?UInt32
```
功能： IPv4 = 1，IPv6 = 2，默认IPv4。
Type: ?UInt32; Readable: true; Writable: false

#### let port

```cangjie
public let port: ?UInt16
```
功能： 端口，取值范围[0, 65535]。
Type: ?UInt16; Readable: true; Writable: false


### NetCapabilities

class NetCapabilities
```cangjie
public class NetCapabilities { public NetCapabilities( public let bearerTypes: Array<NetBearType>, public let linkUpBandwidthKbps!: ?UInt32 = None, public let linkDownBandwidthKbps!: ?UInt32 = None, public let networkCap!: ?Array<NetCap> = None ) }
```
功能： 网络的能力集。

#### let bearerTypes

```cangjie
public let bearerTypes: Array<NetBearType>
```
功能： 网络类型。
Type: Array< NetBearType >; Readable: true; Writable: false

#### let linkDownBandwidthKbps

```cangjie
public let linkDownBandwidthKbps: ?UInt32 = None
```
功能： 下行（网络到设备）带宽，0表示无法评估当前网络带宽。
Type: ?UInt32; Readable: true; Writable: false

#### let linkUpBandwidthKbps

```cangjie
public let linkUpBandwidthKbps: ?UInt32 = None
```
功能： 上行（设备到网络）带宽，0表示无法评估当前网络带宽。
Type: ?UInt32; Readable: true; Writable: false

#### let networkCap

```cangjie
public let networkCap: ?Array<NetCap>= None
```
功能： 网络具体能力。
Type: ?Array< NetCap >; Readable: true; Writable: false


### NetCapabilityInfo

class NetCapabilityInfo
```cangjie
public class NetCapabilityInfo { public NetCapabilityInfo( public let netHandle: NetHandle, public let netCap!: ?NetCapabilities = None ) }
```
功能： 提供承载数据网络能力的实例。

#### let netCap

```cangjie
public let netCap: ?NetCapabilities = None
```
功能： 存储数据网络的传输能力和承载类型。
Type: ? NetCapabilities; Readable: true; Writable: false

#### let netHandle

```cangjie
public let netHandle: NetHandle
```
功能： 数据网络句柄。
Type: NetHandle; Readable: true; Writable: false


### NetConnection

class NetConnection
```cangjie
public class NetConnection {}
```
功能： 网络连接的句柄；设备从无网络到有网络会触发netAvailable事件、netCapabilitiesChange事件和netConnectionPropertiesChange事件； 设备从有网络到无网络状态会触发netLost事件； 设备从WiFi到蜂窝会触发netLost事件（WiFi丢失）之后触发 netAvaliable事件（蜂窝可用）。


### NetHandle

class NetHandle
```cangjie
public class NetHandle <: ToString { public NetHandle(public let netId: Int32) }
```
功能： 数据网络的句柄。在调用NetHandle的方法之前，需要先获取NetHandle对象。

#### let netId

```cangjie
public let netId: Int32
```
功能： 网络ID，取值为0代表没有默认网络，其余取值必须大于等于100。
Type: Int32; Readable: true; Writable: false


### NetSpecifier

class NetSpecifier
```cangjie
public class NetSpecifier { public NetSpecifier( public let netCapabilities: NetCapabilities, public let bearerPrivateIdentifier!: ?String = None ) }
```
功能： 提供承载数据网络能力的实例。

#### let bearerPrivateIdentifier

```cangjie
public let bearerPrivateIdentifier: ?String = None
```
功能： 网络标识符，Wi-Fi网络的标识符是"wifi"，蜂窝网络的标识符是"slot0"（对应SIM卡1）。
Type: ?String; Readable: true; Writable: false

#### let netCapabilities

```cangjie
public let netCapabilities: NetCapabilities
```
功能： 存储数据网络的传输能力和承载类型。
Type: NetCapabilities; Readable: true; Writable: false


### RouteInfo

class RouteInfo
```cangjie
public class RouteInfo { public RouteInfo( public let interfaceName: String, public let destination: LinkAddress, public let gateway: NetAddress, public let hasGateway: Bool, public let isDefaultRoute: Bool ) }
```
功能： 网络路由信息。

#### let destination

```cangjie
public let destination: LinkAddress
```
功能： 目的地址。
Type: LinkAddress; Readable: true; Writable: false

#### let gateway

```cangjie
public let gateway: NetAddress
```
功能： 网关地址。
Type: NetAddress; Readable: true; Writable: false

#### let hasGateway

```cangjie
public let hasGateway: Bool
```
功能： 是否有网关。
Type: Bool; Readable: true; Writable: false

#### let interfaceName

```cangjie
public let interfaceName: String
```
功能： 网卡名称。
Type: String; Readable: true; Writable: false

#### let isDefaultRoute

```cangjie
public let isDefaultRoute: Bool
```
功能： 是否为默认路由。
Type: Bool; Readable: true; Writable: false



## Enums

### NetBearType

enum NetBearType
```cangjie
public enum NetBearType { | BEARER_CELLULAR | BEARER_WIFI | BEARER_ETHERNET | BEARER_BLUETOOTH | BEARER_VPN | ... }
```
功能： 网络类型。

#### BEARER_CELLULAR

```cangjie
BEARER_CELLULAR
```
功能： 蜂窝网络。

#### BEARER_ETHERNET

```cangjie
BEARER_ETHERNET
```
功能： 以太网网络。

#### BEARER_WIFI

```cangjie
BEARER_WIFI
```
功能： Wi-Fi网络。

#### BEARER_BLUETOOTH

```cangjie
BEARER_BLUETOOTH
```
功能： 蓝牙网络。

#### BEARER_VPN

```cangjie
BEARER_WIFI
```
功能： VPN网络。


### NetCap

enum NetCap
```cangjie
public enum NetCap { | NET_CAPABILITY_MMS | NET_CAPABILITY_NOT_METERED | NET_CAPABILITY_INTERNET | NET_CAPABILITY_NOT_VPN | NET_CAPABILITY_VALIDATED | NET_CAPABILITY_PORTAL | NET_CAPABILITY_CHECKING_CONNECTIVITY | ... }
```
功能： 网络具体能力。

#### NET_CAPABILITY_INTERNET

```cangjie
NET_CAPABILITY_INTERNET
```
功能： 表示该网络应具有访问Internet的能力，该能力由网络提供者设置。

#### NET_CAPABILITY_MMS

```cangjie
NET_CAPABILITY_MMS
```
功能： 表示网络可以访问运营商的MMSC（Multimedia Message Service，多媒体短信服务）发送和接收彩信。

#### NET_CAPABILITY_NOT_METERED

```cangjie
NET_CAPABILITY_NOT_METERED
```
功能： 表示网络流量未被计费。

#### NET_CAPABILITY_NOT_VPN

```cangjie
NET_CAPABILITY_NOT_VPN
```
功能： 表示网络不使用VPN（Virtual Private Network，虚拟专用网络）。

#### NET_CAPABILITY_VALIDATED

```cangjie
NET_CAPABILITY_VALIDATED
```
功能： 表示该网络访问Internet的能力被网络管理成功验证，该能力由网络管理模块设置。

#### NET_CAPABILITY_PORTAL

```cangjie
NET_CAPABILITY_PORTAL
```
功能： 表示系统发现该网络存在强制网络门户，需要用户登陆认证，该能力由网络管理模块设置。

#### NET_CAPABILITY_CHECKING_CONNECTIVITY

```cangjie
NET_CAPABILITY_CHECKING_CONNECTIVITY
```
功能： 表示网络管理正在检验当前网络的连通性，此值会在网络连接时设置，直到连通性检测结束后不再设置，当此值存在时，NET_CAPABILITY_VALIDATED的值可能不准确。



