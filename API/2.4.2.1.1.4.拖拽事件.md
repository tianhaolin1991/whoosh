# 拖拽事件

拖拽事件指组件被长按后拖拽时触发的事件。

## Functions

### public func onDragStart(callback: (DragInfo)-> DragItemInfo): This

```cangjie
public func onDragStart(callback: (DragInfo)-> DragItemInfo): This
```
功能： 第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )-> DragItemInfo | 是 | 回调函数，拖拽开始时触发。 传入参数为拖拽事件信息，包括拖拽点坐标。 返回参数为拖拽过程中显示的组件信息。 | callback | - |

### public func onDragStart(callback: (DragInfo)-> (() -> Unit)): This

```cangjie
public func onDragStart(callback: (DragInfo)-> (() -> Unit)): This
```
功能： 重载拖拽事件，第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo ) | 是 | 回调函数，拖拽开始时触发。 传入参数为拖拽事件信息，包括拖拽点坐标。 返回参数为拖拽过程中显示的组件信息，使用时结合 @Builder 和 bind 方法使用。 | callback | - |

### public func onDragStart(callback: (DragInfo)-> Unit): This

```cangjie
public func onDragStart(callback: (DragInfo)-> Unit): This
```
功能： 重载拖拽事件，第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )->Unit | 是 | 回调函数，拖拽开始时触发。 传入参数为拖拽事件信息，包括拖拽点坐标。 返回参数为拖拽过程中显示的组件信息。 | callback | - |

### public func onDragStart(callback: (DragEvent, ?String)->DragItemInfo): This

```cangjie
public func onDragStart(callback: (DragEvent, ?String)->DragItemInfo): This
```
功能： 重载拖拽事件，第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)-> DragItemInfo | 是 | 回调函数。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 返回参数为拖拽过程中显示的组件信息。 | callback | - |

### public func onDragStart(callback: (DragEvent, ?String)->(()->Unit)): This

```cangjie
public func onDragStart(callback: (DragEvent, ?String)->(()->Unit)): This
```
功能： 重载拖拽事件，第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->(()->Unit) | 是 | 回调函数。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDragStart(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDragStart(callback: (DragEvent, ?String)->Unit): This
```
功能： 重载拖拽事件，第一次拖拽此事件绑定的组件时，长按时间 >= 500ms，然后手指移动距离 >= 10vp，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->Unit | 是 | 回调函数。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDragEnter(callback: (DragInfo)->Unit): This

```cangjie
public func onDragEnter(callback: (DragInfo)->Unit): This
```
功能： 拖拽进入组件范围内时，触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )->Unit | 是 | 拖拽进入组件范围回调函数。 | callback | - |

### public func onDragEnter(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDragEnter(callback: (DragEvent, ?String)->Unit): This
```
功能： 拖拽进入组件范围内时，触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent ,?String)->Unit | 是 | 回调函数。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDragMove(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDragMove(callback: (DragEvent, ?String)->Unit): This
```
功能： 拖拽在组件范围内移动时，触发回调，当监听了onDrop事件时，此事件才有效。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->Unit | 是 | 回调函数，拖拽进入组件范围移动时触发。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDragMove(callback: (DragInfo)->Unit): This

```cangjie
public func onDragMove(callback: (DragInfo)->Unit): This
```
功能： 拖拽在组件范围内移动时，触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )->Unit | 是 | 回调函数，拖拽进入组件范围移动时触发。 | callback | - |

### public func onDragLeave(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDragLeave(callback: (DragEvent, ?String)->Unit): This
```
功能： 拖拽离开组件范围内时，触发回调，当监听了onDrop事件时，此事件才有效。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->Unit | 是 | 回调函数，拖拽进入组件范围移动时触发。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDragLeave(callback: (DragInfo)->Unit): This

```cangjie
public func onDragLeave(callback: (DragInfo)->Unit): This
```
功能： 拖拽离开组件范围内时，触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )->Unit | 是 | 回调函数，拖拽离开组件范围时触发。 传入参数为拖拽事件信息，包括拖拽点坐标。 | callback | - |

### public func onDrop(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDrop(callback: (DragEvent, ?String)->Unit): This
```
功能： 绑定此事件的组件可作为拖拽释放目标，当在本组件范围内停止拖拽行为时，触发回调。如果开发者没有在onDrop中主动调用event.setResult()设置拖拽接收的结果，若拖拽组件为系统支持默认拖入的组件，以系统实际处理数据结果为准，其它组件则系统按照数据接收成功处理。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->Unit | 是 | 回调函数，本组件范围内停止拖拽行为时触发。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onDrop(callback: (DragInfo)->Unit): This

```cangjie
public func onDrop(callback: (DragInfo)->Unit): This
```
功能： 绑定此事件的组件可作为拖拽释放目标，当在本组件范围内停止拖拽行为时，触发该事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragInfo )->Unit | 是 | 回调函数，本组件范围内停止拖拽行为时触发。 传入参数为拖拽事件信息，包括拖拽点坐标。 | callback | - |

### public func onDragEnd(callback: (DragEvent, ?String)->Unit): This

```cangjie
public func onDragEnd(callback: (DragEvent, ?String)->Unit): This
```
功能： 绑定此事件的组件触发的拖拽结束后，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( DragEvent , ?String)->Unit | 是 | 回调函数，拖拽结束后触发。 第一个参数为拖拽事件信息，包括拖拽点坐标。 第二个参数为拖拽事件额外信息，需要解析为Json格式，参考 extraParams说明 。 | callback | - |

### public func onPreDrag(callback: (PreDragStatus)->Unit): This

```cangjie
public func onPreDrag(callback: (PreDragStatus)->Unit): This
```
功能： 绑定此事件的组件，当触发拖拽发起前的不同阶段时，触发回调。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| ( PreDragStatus )->Unit | 是 | 回调函数，拖拽发起前触发。 | callback | - |


## Classes

### DragEvent

class DragEvent
```cangjie
public class DragEvent { public let useCustomDropAnimation: Bool public let dragBehavior: DragBehavior }
```
功能： 拖拽事件类型。

#### let dragBehavior

```cangjie
public let dragBehavior: DragBehavior
```
功能： 切换复制和剪贴模式的角标显示状态。
Type: DragBehavior; Readable: true; Writable: false

#### let useCustomDropAnimation

```cangjie
public let useCustomDropAnimation: Bool
```
功能： 当拖拽结束时，是否使能并使用系统默认落位动效。 应用可将该值设定为true来禁用系统默认落位动效，并实现自己的自定义落位动效。 当不配置或设置为false时，系统默认落位动效生效，当松手位置的控件可接收拖拽的数据时，落位为缩小消失动效，若不可接收数据，则为放大消失动效。 当未禁用系统默认落位动效情况下，应用不应再实现自定义动效，以避免动效上的冲突。
Type: Bool; Readable: true; Writable: false


### DragInfo

class DragInfo
```cangjie
public class DragInfo { public DragInfo( public var extraParams: String, public var dragEvent: Position ) }
```
功能： 拖拽动作参数配置类型。

#### var dragEvent

```cangjie
public var dragEvent: Position
```
功能： 存储拖拽点坐标信息。
Type: Position; Readable: true; Writable: true

#### var extraParams

```cangjie
public var extraParams: String
```
功能： 存储拖拽事件额外信息。
Type: String; Readable: true; Writable: true



## Structs

### DragItemInfo

struct DragItemInfo
```cangjie
public struct DragItemInfo { public DragItemInfo( public var pixelMap!: Option<PixelMap> = Option.None , public var builder!: Option<() -> Unit> = Option.None, public var extraInfo!: String = "" ) }
```
功能： 拖拽过程中显示的组件信息。



## Enums

### DragBehavior

enum DragBehavior
```cangjie
public enum DragBehavior { | COPY | MOVE | UNKNOWN }
```
功能： 当设置 DragResult 为DROP_ENABLED后，可设置DragBehavior为复制（copy）或剪切（move）。DragBehavior用来向开发者描述数据的处理方式是复制（copy）还是剪切（move），但无法最终决定对数据的实际处理方式。DragBehavior会通过onDragEnd带回给数据拖出方，发起拖拽的一方可通过DragBehavior来区分做出的是复制还是剪切数据的不同行为。

#### COPY

```cangjie
COPY
```
功能： 指定对数据的处理方式为复制。

#### MOVE

```cangjie
MOVE
```
功能： 指定对数据的处理方式为剪切。

#### UNKNOWN

```cangjie
UNKNOWN
```
功能： 未知行为，可用于错误处理。


### DragResult

enum DragResult
```cangjie
public enum DragResult { | DRAG_SUCCESSFUL | DRAG_FAILED | DRAG_CANCELED | DROP_ENABLED | DROP_DISABLED | DRAG_DEFAULT }
```
功能： 拖拽结果。

#### DRAG_CANCELED

```cangjie
DRAG_CANCELED
```
功能： 拖拽取消，在onDrop中使用。

#### DRAG_DEFAULT

```cangjie
DRAG_DEFAULT
```
功能： 默认拖拽结果。

#### DRAG_FAILED

```cangjie
DRAG_FAILED
```
功能： 拖拽失败，在onDrop中使用。

#### DRAG_SUCCESSFUL

```cangjie
DRAG_SUCCESSFUL
```
功能： 拖拽成功，在onDrop中使用。

#### DROP_DISABLED

```cangjie
DROP_DISABLED
```
功能： 组件不允许落入，在onDragMove中使用。

#### DROP_ENABLED

```cangjie
DROP_ENABLED
```
功能： 组件允许落入，在onDragMove中使用。


### PreDragStatus

enum PreDragStatus
```cangjie
public enum PreDragStatus { | ACTION_DETECTING_STATUS | READY_TO_TRIGGER_DRAG_ACTION | PREVIEW_LIFT_STARTED | PREVIEW_LIFT_FINISHED | PREVIEW_LANDING_STARTED | PREVIEW_LANDING_FINISHED | ACTION_CANCELED_BEFORE_DRAG }
```
功能： 拖拽启动状态。

#### ACTION_CANCELED_BEFORE_DRAG

```cangjie
ACTION_CANCELED_BEFORE_DRAG
```
功能： 拖拽浮起落位动效中断。(已满足READY_TO_TRIGGER_DRAG_ACTION状态后，未达到动效阶段，手指抬手时触发)。

#### ACTION_DETECTING_STATUS

```cangjie
ACTION_DETECTING_STATUS
```
功能： 拖拽手势启动阶段。(按下50ms时触发)。

#### PREVIEW_LANDING_FINISHED

```cangjie
PREVIEW_LANDING_FINISHED
```
功能： 拖拽落回动效结束阶段。(落回动效结束时触发)。

#### PREVIEW_LANDING_STARTED

```cangjie
PREVIEW_LANDING_STARTED
```
功能： 拖拽落回动效发起阶段。(落回动效发起时触发)。

#### PREVIEW_LIFT_FINISHED

```cangjie
PREVIEW_LIFT_FINISHED
```
功能： 拖拽浮起动效结束阶段。(浮起动效完全结束时触发)。

#### PREVIEW_LIFT_STARTED

```cangjie
PREVIEW_LIFT_STARTED
```
功能： 拖拽浮起动效发起阶段。(按下800ms时触发)。

#### READY_TO_TRIGGER_DRAG_ACTION

```cangjie
READY_TO_TRIGGER_DRAG_ACTION
```
功能： 拖拽准备完成，可发起拖拽阶段。(按下500ms时触发)。



## Examples

```cangjie
package ohos_app_cangjie_entry

import kit.UIKit.*
import ohos.state_macro_manage.*
import ohos.resource_manager.*

@Entry
@Component
class EntryView {
 @State
 var imgState: Visibility = Visibility.Visible
 @Builder
 func pixelMapBuilder() {
 Column() {
 Image(@r(app.media.startIcon))
 .width(120)
 .height(120)
 .backgroundColor(Color.YELLOW)
 }
 }
 func parseDragBehavior(v: DragBehavior): String {
 match (v) {
 case DragBehavior.MOVE => "MOVE"
 case DragBehavior.COPY => "COPY"
 case _ => "UNKNOW"
 }
 }
 func build() {
 Row() {
 Column() {
 List() {
 ListItem() {
 Text("ListItem1")
 .fontSize(18)
 .width(100.percent)
 .height(40)
 .margin(10)
 }.onDragStart(
 {
 event: DragEvent, extra: ?String => if (let Some(v) <- extra) {
 PromptAction.showToast(message: v)
 }
 })
 ListItem() {
 Text("ListItem2")
 .fontSize(18)
 .width(100.percent)
 .height(40)
 .margin(10)
 }.onDragStart(
 {
 event: DragEvent, extra: ?String =>
 if (let Some(v) <- extra) {
 PromptAction.showToast(message: v)
 }
 return DragItemInfo(builder: bind(pixelMapBuilder, this), extraInfo: "ListItem1")
 }
 )
 }.onDrop(
 {
 event: DragEvent, extra: ?String => if (let Some(v) <- extra) {
 PromptAction.showToast(message: v)
 }
 })
 Text("Start Drag")
 .fontSize(18)
 .width(100.percent)
 .height(40)
 .margin(10)
 .backgroundColor(0x008888)
 Image(@r(app.media.startIcon))
 .width(100)
 .height(100)
 .draggable(true)
 .margin(left: 15)
 .visibility(imgState)
 .onDragEnd(
 {
 event: DragEvent, extra: ?String => match (event.getResult()) {
 case DragResult.DRAG_SUCCESSFUL => PromptAction.showToast(message: "Drag Success")
 case _ => PromptAction.showToast(message: "Drag Failed")
 }
 })
 Text("test drag event")
 .width(100.percent)
 .height(100)
 .draggable(true)
 .margin(left: 15)
 .copyOption(CopyOptions.InApp)
 TextArea(placeholder: "please input words")
 .copyOption(CopyOptions.InApp)
 .width(100.percent)
 .height(50)
 Search(placeholder: "please input words")
 .searchButton("Search")
 .width(100.percent)
 .height(80)
 .textFont(size: 20)
 }
 .width(45.percent)
 .height(100.percent)

 Column() {
 Text("Drag Target Area")
 .fontSize(20)
 .width(100.percent)
 .height(40)
 .margin(10)
 .backgroundColor(0x008888)
 .onDrop(
 {
 dragEvent: DragEvent, extra: ?String =>
 dragEvent.setResult(DragResult.DRAG_SUCCESSFUL)
 PromptAction.showToast(
 message: "${dragEvent.useCustomDropAnimation}, ${parseDragBehavior(dragEvent.dragBehavior)}"
 )
 }
 )
 }
 }
 }
}
```

