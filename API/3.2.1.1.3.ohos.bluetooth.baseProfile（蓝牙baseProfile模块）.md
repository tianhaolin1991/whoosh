# ohos.bluetooth.baseProfile（蓝牙baseProfile模块）

baseProfile模块提供了基础的Profile类型和相关方法。

```cangjie
import kit.ConnectivityKit.*
```
## Interfaces

### BaseProfile

interface BaseProfile
```cangjie
public interface BaseProfile { func getConnectedDevices(): Array<String> func getConnectionState(deviceId: String): ProfileConnectionState func on(`type`: ProfileCallbackType, callback: Callback1Argument<StateChangeParam>): Unit func off(`type`: ProfileCallbackType, callback: CallbackObject): Unit func off(`type`: ProfileCallbackType): Unit }
```
功能： Profile 基础类型。

#### func getConnectedDevices(): Array<String>

```cangjie
func getConnectedDevices(): Array<String>
```
功能： 获取已连接设备列表。

**Returns:**

| type | description |
| --- | --- |
| Array<String> | 返回当前已连接设备的地址。基于信息安全考虑，此处获取的设备地址为随机MAC地址。配对成功后，该地址不会变更；已配对设备取消配对后重新扫描或蓝牙服务下电时，该随机地址会变更。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 蓝牙服务子系统错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 801 | Capability not supported. |
| 2900001 | Service stopped. |
| 2900003 | Bluetooth disabled. |
| 2900004 | Profile not supported. |
| 2900099 | Operation failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.ConnectivityKit.*
import ohos.hilog.Hilog

try {
 let a2dpSrc = createA2dpSrcProfile()
 let retArray = a2dpSrc.getConnectedDevices()
} catch (e: BusinessException) {
 Hilog.info(0, "Bluetooth", "errCode: ${e.code}, errMessage: ${e.message}")
}
```

#### func getConnectionState(deviceId: String): ProfileConnectionState

```cangjie
func getConnectionState(deviceId: String): ProfileConnectionState
```
功能： 获取设备Profile的连接状态。

**Parameters:**

| type | description | name | required |
| --- | --- | --- | --- |
| String | 远端设备地址。 | deviceId | 是 |

**Returns:**

| type | description |
| --- | --- |
| ProfileConnectionState | 返回Profile的连接状态。 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 蓝牙服务子系统错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed. |
| 801 | Capability not supported. |
| 2900001 | Service stopped. |
| 2900003 | Bluetooth disabled. |
| 2900004 | Profile not supported. |
| 2900099 | Operation failed. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.ConnectivityKit.*
import ohos.hilog.Hilog

try {
 let a2dpSrc = createA2dpSrcProfile()
 let retArray = a2dpSrc.getConnectionState("XX:XX:XX:XX:XX:XX")
} catch (e: BusinessException) {
 Hilog.info(0, "Bluetooth", "errCode: ${e.code}, errMessage: ${e.message}")
}
```

#### func off(`type`: ProfileCallbackType, callback: CallbackObject): Unit

```cangjie
func off(`type`: ProfileCallbackType, callback: CallbackObject): Unit
```
功能： 取消所有订阅连接状态变化事件。

**Parameters:**

| type | description | name | required |
| --- | --- | --- | --- |
| ProfileCallbackType | 回调事件类型。 | `type` | 是 |
| CallbackObject | 回调事件。 | callback | 是 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 蓝牙服务子系统错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed. |
| 801 | Capability not supported. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.ConnectivityKit.*
import ohos.hilog.Hilog

// 此处定义所需要的依赖项等
class StateChangeCallback <: Callback1Argument<StateChangeParam> {
 public func invoke(arg: StateChangeParam): Unit {
 let connectionState = arg.state.toString()
 Hilog.info(0, "Bluetooth", "profile connection state has change to ${connectionState}")
 }
}

let changeCallBack = StateChangeCallback()
let a2dp = createA2dpSrcProfile()
try {
 a2dp.on(ProfileCallbackType.CONNECTION_STATE_CHANGE, changeCallBack)
 a2dp.off(ProfileCallbackType.CONNECTION_STATE_CHANGE, changeCallBack)
} catch (e: BusinessException) {
 Hilog.info(0, "Bluetooth", "errCode: ${e.code}, errMessage: ${e.message}")
}
```

#### func off(`type`: ProfileCallbackType): Unit

```cangjie
func off(`type`: ProfileCallbackType): Unit
```
功能： 取消所有订阅连接状态变化事件。

**Parameters:**

| type | description | name | required |
| --- | --- | --- | --- |
| ProfileCallbackType | 回调事件类型。 | `type` | 是 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 和 蓝牙服务子系统错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed. |
| 801 | Capability not supported. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.ConnectivityKit.*
import ohos.hilog.Hilog

// 此处定义所需要的依赖项等
class StateChangeCallback <: Callback1Argument<StateChangeParam> {
 public func invoke(arg: StateChangeParam): Unit {
 let connectionState = arg.state.toString()
 Hilog.info(0, "Bluetooth", "profile connection state has change to ${connectionState}")
 }
}

let changeCallBack = StateChangeCallback()
let a2dp = createA2dpSrcProfile()
try {
 a2dp.on(ProfileCallbackType.CONNECTION_STATE_CHANGE, changeCallBack)
 a2dp.off(ProfileCallbackType.CONNECTION_STATE_CHANGE)
} catch (e: BusinessException) {
 Hilog.info(0, "Bluetooth", "errCode: ${e.code}, errMessage: ${e.message}")
}
```

#### func on(`type`: ProfileCallbackType, callback: Callback1Argument<StateChangeParam>): Unit

```cangjie
func on(`type`: ProfileCallbackType, callback: Callback1Argument<StateChangeParam>): Unit
```
功能： 订阅连接状态变化事件。使用Callback异步回调。

**Parameters:**

| type | description | name | required |
| --- | --- | --- | --- |
| ProfileCallbackType | 传入 CONNECTIONSTATECHANGE ，表示连接状态变化事件类型。 | `type` | 是 |
| Callback1Argument < StateChangeParam > | 表示回调函数的入参。 | callback | 是 |

**Exceptions:**

- **BusinessException**: BusinessException：对应错误码的详细介绍请参见 通用错误码 。

| code | description |
| --- | --- |
| 201 | Permission denied. |
| 401 | Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed. |
| 801 | Capability not supported. |


**Example:**

```cangjie
// index.cj

import ohos.base.*
import kit.ConnectivityKit.*
import ohos.hilog.Hilog

// 此处定义所需要的依赖项等
class StateChangeCallback <: Callback1Argument<StateChangeParam> {
 public func invoke(arg: StateChangeParam): Unit {
 let connectionState = arg.state.toString()
 Hilog.info(0, "Bluetooth", "profile connection state has change to ${connectionState}")
 }
}

let changeCallBack = StateChangeCallback()
let a2dp = createA2dpSrcProfile()
try {
 a2dp.on(ProfileCallbackType.CONNECTION_STATE_CHANGE, changeCallBack)
} catch (e: BusinessException) {
 Hilog.info(0, "Bluetooth", "errCode: ${e.code}, errMessage: ${e.message}")
}
```



## Classes

### StateChangeParam

class StateChangeParam
```cangjie
public class StateChangeParam {}
```
功能： 描述profile状态改变参数。

#### let cause

```cangjie
public let cause: DisconnectCause
```
功能： 表示连接失败的原因。
Type: DisconnectCause; Readable: true; Writable: false

#### let deviceId

```cangjie
public let deviceId: String
```
功能： 表示蓝牙设备地址。
Type: String; Readable: true; Writable: false

#### let state

```cangjie
public let state: ProfileConnectionState
```
功能： 表示蓝牙设备的profile连接状态。
Type: ProfileConnectionState; Readable: true; Writable: false



## Enums

### DisconnectCause

enum DisconnectCause
```cangjie
public enum DisconnectCause <: Equatable<DisconnectCause> & ToString { | USER_DISCONNECT | CONNECT_FROM_KEYBOARD | CONNECT_FROM_MOUSE | CONNECT_FROM_CAR | TOO_MANY_CONNECTED_DEVICES | CONNECT_FAIL_INTERNAL | ... }
```
功能： 连接失败原因。

#### CONNECT_FAIL_INTERNAL

```cangjie
CONNECT_FAIL_INTERNAL
```
功能： 内部错误。

#### CONNECT_FROM_CAR

```cangjie
CONNECT_FROM_CAR
```
功能： 应该从车机侧发起连接。

#### CONNECT_FROM_KEYBOARD

```cangjie
CONNECT_FROM_KEYBOARD
```
功能： 应该从键盘侧发起连接。

#### CONNECT_FROM_MOUSE

```cangjie
CONNECT_FROM_MOUSE
```
功能： 应该从鼠标侧发起连接。

#### TOO_MANY_CONNECTED_DEVICES

```cangjie
TOO_MANY_CONNECTED_DEVICES
```
功能： 当前连接数超过上限。

#### USER_DISCONNECT

```cangjie
USER_DISCONNECT
```
功能： 用户主动断开连接。


### ProfileCallbackType

enum ProfileCallbackType
```cangjie
public enum ProfileCallbackType <: Equatable<ProfileCallbackType> & Hashable & ToString { | CONNECTION_STATE_CHANGE | ... }
```
功能： bluetooth baseprofile 回调事件。

#### CONNECTION_STATE_CHANGE

```cangjie
CONNECTION_STATE_CHANGE
```
功能： 表示连接状态变化事件类型。



