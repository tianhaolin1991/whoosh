# 自定义事件分发

在处理触屏事件时，会在触屏事件触发前进行按压点和组件区域的触摸测试，来收集需要响应触屏事件的组件，再基于触摸测试结果分发相应的触屏事件。在父节点，开发者可以通过onChildTouchTest决定如何让子节点去做触摸测试，影响子组件的触摸测试，最终影响后续的触屏事件分发，具体影响参考 TouchTestStrategy 枚举说明。

## Functions

### public func onChildTouchTest(callback: (Array<TouchTestInfo>) -> TouchResult): This

```cangjie
public func onChildTouchTest(callback: (Array<TouchTestInfo>) -> TouchResult): This
```
功能： 设置自定义子节点的触摸测试事件。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| (Array< TouchTestInfo >)-> TouchResult | 是 | 回调函数，自定义子节点进行触摸测试时触发。 参数：包含子节点信息的数组。 返回值：自定义事件分发结果。 | callback | - |


## Classes

### TouchTestInfo

class TouchTestInfo
```cangjie
public class TouchTestInfo { public let windowX: Float32 public let windowY: Float32 public let parentX: Float32 public let parentY: Float32 public let x: Float32 public let y: Float32 public let rect: RectResult public let id: String public init(windowX: Float32, windowY: Float32, parentX: Float32, parentY: Float32, x: Float32, y: Float32, rect: RectResult, id: String) }
```
功能： 表示当前按压点所在组件的坐标系、id和尺寸相关信息的类型。

#### let id

```cangjie
public let id: String
```
功能： 存放当前按压点所在组件的id。
Type: String; Readable: true; Writable: false

#### let parentX

```cangjie
public let parentX: Float32
```
功能： 存放按压点相对于父组件左上角的横向坐标。
Type: Float32; Readable: true; Writable: false

#### let parentY

```cangjie
public let parentY: Float32
```
功能： 存放按压点相对于父组件左上角的纵向坐标。
Type: Float32; Readable: true; Writable: false

#### let rect

```cangjie
public let rect: RectResult
```
功能： 存放子组件的大小信息。
Type: RectResult; Readable: true; Writable: false

#### let windowX

```cangjie
public let windowX: Float32
```
功能： 存放按压点相对于窗口左上角的横向坐标。
Type: Float32; Readable: true; Writable: false

#### let windowY

```cangjie
public let windowY: Float32
```
功能： 存放按压点相对于窗口左上角的纵向坐标。
Type: Float32; Readable: true; Writable: false

#### let x

```cangjie
public let x: Float32
```
功能： 存放按压点相对于子组件的左上角的横向坐标。
Type: Float32; Readable: true; Writable: false

#### let y

```cangjie
public let y: Float32
```
功能： 存放按压点相对于子组件的左上角的纵向坐标。
Type: Float32; Readable: true; Writable: false


### TouchResult

class TouchResult
```cangjie
public class TouchResult { public init(strategy: TouchTestStrategy, id!: String = "") public init(cTouchResult: CTouchResult) }
```
功能： 自定义事件分发结果，开发者通过返回结果来影响事件分发。



## Enums

### TouchTestStrategy

enum TouchTestStrategy
```cangjie
public enum TouchTestStrategy { | DEFAULT | FORWARD_COMPETITION | FORWARD }
```
功能： 事件派发策略。

#### DEFAULT

```cangjie
DEFAULT
```
功能： 自定义分发不产生影响，系统按当前节点命中状态分发事件。

#### FORWARD

```cangjie
FORWARD
```
功能： 应用指定分发事件到某个子节点，系统不再处理分发事件到其他兄弟节点。

#### FORWARD_COMPETITION

```cangjie
FORWARD_COMPETITION
```
功能： 应用指定分发事件到某个子节点，其他兄弟节点是否分发事件交由系统决定。



## Examples

```cangjie
package ohos_app_cangjie_entry

import kit.UIKit.*
import ohos.state_macro_manage.*
import std.collection.{ArrayList, HashMap}

@Entry
@Component
class EntryView {
 @State var value: Int32 = 1
 @State var text: String = "Button"
 let numbers: ArrayList<Int64> = ArrayList<Int64>([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])
 func touchTestInfo(touchinfo: Array<TouchTestInfo>): TouchResult {
 let items = ArrayList<TouchTestInfo>()
 for (item in touchinfo) {
 if (item.id == 'MyList') {
 return TouchResult(TouchTestStrategy.FORWARD_COMPETITION, id: item.id)
 }
 }
 return TouchResult(TouchTestStrategy.DEFAULT, id: "")
 }

 func build() {
 Column {
 List(space: 10, initialIndex: 0) {
 ForEach(this.numbers, itemGeneratorFunc: { item: Int64, _: Int64 =>
 ListItem() {
 Text("${item}")
 .width(100.percent)
 .height(56)
 .fontSize(16)
 .textAlign(TextAlign.Start)
 }
 .backgroundColor(Color.WHITE)
 .borderRadius(24)
 .padding(left: 12, right: 12)
 }
 )
 }
 .listDirection(Axis.Vertical)
 .scrollBar(BarState.Off)
 .edgeEffect(EdgeEffect.Spring)
 .onScrollIndex({first: Int32, last: Int32 =>
 AppLog.info("first: " + first.toString() + " last: " + last.toString())
 })
 .onDidScroll({scrollOffset: Float64, scrollState: ScrollState =>
 AppLog.info('onScroll scrollState = ScrollState.${scrollState.toString()}, scrollOffset = ${scrollOffset}')
 })
 .width(100.percent)
 .height(65.percent)
 .id("MyList")

 Button(this.text)
 .width(312)
 .height(40)
 .id("Mybutton")
 .margin(top: 80)
 .fontSize(16)
 .fontWeight(FontWeight.Medium)
 .onClick({evt =>
 this.text = "click the button"
 PromptAction.showToast(message: "you click the button", duration: 3000)
 })
 }
 .width(100.percent)
 .height(100.percent)
 .backgroundColor(0xF1F3F5)
 .justifyContent(FlexAlign.End)
 .padding(left: 12, right: 12, bottom: 24)
 .onChildTouchTest(touchTestInfo)
 }
}
```
```cangjie
package ohos_app_cangjie_entry

import kit.UIKit.*
import ohos.state_macro_manage.*
import std.collection.{ArrayList, HashMap}

@Entry
@Component
class EntryView {
 @State var value: Int32 = 1
 @State var text: String = "Button"
 let numbers: ArrayList<Int64> = ArrayList<Int64>([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])
 func touchTestInfo(touchinfo: Array<TouchTestInfo>): TouchResult {
 let items = ArrayList<TouchTestInfo>()
 for (item in touchinfo) {
 if (item.id == 'MyList') {
 return TouchResult(TouchTestStrategy.FORWARD, id: item.id)
 }
 }
 return TouchResult(TouchTestStrategy.DEFAULT, id: "")
 }

 func build() {
 Column {
 List(space: 10, initialIndex: 0) {
 ForEach(this.numbers, itemGeneratorFunc: { item: Int64, _: Int64 =>
 ListItem() {
 Text("${item}")
 .width(100.percent)
 .height(56)
 .fontSize(16)
 .textAlign(TextAlign.Center)
 .borderRadius(10)
 .backgroundColor(0xFFFFFF)
 }
 .backgroundColor(Color.WHITE)
 .borderRadius(24)
 .padding(12)
 }
 )
 }
 .scrollBar(BarState.Off)
 .width(80.percent)
 .onScrollIndex({first: Int32, last: Int32 =>
 AppLog.info("first: " + first.toString() + " last: " + last.toString())
 })
 .width(100.percent)
 .height(65.percent)
 .id("MyList")

 Button(this.text)
 .width(312)
 .height(40)
 .id("Mybutton")
 .onClick({evt =>
 this.text = "click the button"
 PromptAction.showToast(message: "you click the button", duration: 3000)
 })
 }
 .width(100.percent)
 .height(100.percent)
 .onChildTouchTest(touchTestInfo)
 }
}
```
```cangjie
package ohos_app_cangjie_entry

import kit.UIKit.*
import ohos.state_macro_manage.*
import std.collection.{ArrayList, HashMap}

@Entry
@Component
class EntryView {
 @State var value: Int32 = 1
 @State var text: String = "Button"
 let numbers: ArrayList<Int64> = ArrayList<Int64>([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12])
 func touchTestInfo(touchinfo: Array<TouchTestInfo>): TouchResult {
 return TouchResult(TouchTestStrategy.DEFAULT, id: "")
 }

 func build() {
 Column {
 List(space: 10, initialIndex: 0) {
 ForEach(this.numbers, itemGeneratorFunc: { item: Int64, _: Int64 =>
 ListItem() {
 Text("${item}")
 .width(100.percent)
 .height(56)
 .fontSize(16)
 .textAlign(TextAlign.Start)
 }
 .backgroundColor(Color.WHITE)
 .borderRadius(24)
 .padding(left: 12, right: 12)
 }
 )
 }
 .listDirection(Axis.Vertical)
 .scrollBar(BarState.Off)
 .edgeEffect(EdgeEffect.Spring)
 .onScrollIndex({first: Int32, last: Int32 =>
 AppLog.info("first: " + first.toString() + " last: " + last.toString())
 })
 .onDidScroll({scrollOffset: Float64, scrollState: ScrollState =>
 AppLog.info('onScroll scrollState = ScrollState.${scrollState.toString()}, scrollOffset = ${scrollOffset}')
 })
 .width(100.percent)
 .height(65.percent)
 .id("MyList")

 Button(this.text)
 .width(312)
 .height(40)
 .id("Mybutton")
 .margin(top: 80)
 .fontSize(16)
 .fontWeight(FontWeight.Medium)
 .onClick({evt =>
 this.text = "click the button"
 PromptAction.showToast(message: "you click the button", duration: 3000)
 })
 }
 .width(100.percent)
 .height(100.percent)
 .backgroundColor(0xF1F3F5)
 .justifyContent(FlexAlign.End)
 .padding(left: 12, right: 12, bottom: 24)
 .onChildTouchTest(touchTestInfo)
 }
}
```

