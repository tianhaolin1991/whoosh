# LazyForEach

LazyForEach调用形式如下：

```cangjie
import kit.UIKit.*
```
## Interfaces

### DataOperation

interface DataOperation
```cangjie
public interface DataOperation {}
```
功能： 数据操作公共类型定义。


### IDataSource

interface IDataSource
```cangjie
public interface IDataSource<T> { func totalCount(): Int64 func getData(index: Int64): T func onRegisterDataChangeListener(listener: DataChangeListener): Unit func onUnregisterDataChangeListener(listener: DataChangeListener): Unit }
```
功能： LazyForEach数据源，需要开发者实现相关接口。

#### func getData(index: Int64): T

```cangjie
func getData(index: Int64): T
```
功能： 获取索引值index对应的数据。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| Int64 | 是 | 数据对应的索引值。 | index | - |

**Returns:**

| type | description |
| --- | --- |
| T | 索引值index对应的数据。 |

#### func onRegisterDataChangeListener(listener: DataChangeListener): Unit

```cangjie
func onRegisterDataChangeListener(listener: DataChangeListener): Unit
```
功能： 注册数据改变的监听器。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| DataChangeListener | 是 | 数据变化监听器。 | listener | - |

#### func onUnregisterDataChangeListener(listener: DataChangeListener): Unit

```cangjie
func onUnregisterDataChangeListener(listener: DataChangeListener): Unit
```
功能： 注销数据改变的监听器。

**Parameters:**

| type | required | description | name | default |
| --- | --- | --- | --- | --- |
| DataChangeListener | 是 | 数据变化监听器。 | listener | - |

#### func totalCount(): Int64

```cangjie
func totalCount(): Int64
```
功能： 获得数据总数。

**Returns:**

| type | description |
| --- | --- |
| Int64 | 数据总数。 |



## Classes

### LazyForEach

class LazyForEach
LazyForEach调用形式如下：


### DataChangeListener

class DataChangeListener
```cangjie
public class DataChangeListener { public DataChangeListener(id: Int64) }
```
功能： 数据变化监听器。


### DataAddOperation

class DataAddOperation
```cangjie
public class DataAddOperation <: DataOperation { public DataAddOperation(index: Int32, count!: Int32 = 1, key!: ?String = None, keys!: ?Array<String> = None) }
```
功能： 添加数据操作。


### DataChangeOperation

class DataChangeOperation
```cangjie
public class DataChangeOperation <: DataOperation { public DataChangeOperation(public let index: Int32, public let key!: ?String = "") }
```
功能： 改变数据操作。

#### let index

```cangjie
public let index: Int32
```
功能： 改变的数据的索引值。
Type: Int32; Readable: true; Writable: false

#### let key

```cangjie
public let key:?String = ""
```
功能： 为改变的数据分配新的键值，默认使用原键值。
Type: ?String; Readable: true; Writable: false


### DataDeleteOperation

class DataDeleteOperation
```cangjie
public class DataDeleteOperation <: DataOperation { public DataDeleteOperation(public let index: Int32, public let count!: Int32 = 1) }
```
功能： 删除数据操作。

#### let count

```cangjie
public let count: Int32 = 1
```
功能： 删除数据数量。
Type: Int32; Readable: true; Writable: false

#### let index

```cangjie
public let index: Int32
```
功能： 起始删除位置索引值。
Type: Int32; Readable: true; Writable: false


### DataExchangeOperation

class DataExchangeOperation
```cangjie
public class DataExchangeOperation <: DataOperation { public DataExchangeOperation(public let start!: Int32, public let end!: Int32, public let key!: ExchangeKey = ExchangeKey()) }
```
功能： 交换数据操作。

#### let end

```cangjie
public let end: Int32
```
功能： 第二个交换位置。
Type: Int32; Readable: true; Writable: false

#### let key

```cangjie
public let key: ExchangeKey = ExchangeKey()
```
功能： 分配新的键值，默认使用原键值。
Type: ExchangeKey; Readable: true; Writable: false

#### let start

```cangjie
public let start: Int32
```
功能： 第一个交换位置。
Type: Int32; Readable: true; Writable: false


### DataMoveOperation

class DataMoveOperation
```cangjie
public class DataMoveOperation <: DataOperation { public DataMoveOperation(public let from!: Int32, public let to!: Int32, public let key!: ?String = "") }
```
功能： 移动数据操作。

#### let from

```cangjie
public let from: Int32
```
功能： 起始移动位置。
Type: Int32; Readable: true; Writable: false

#### let key

```cangjie
public let key:?String = ""
```
功能： 为被移动的数据分配新的键值，默认使用原键值。
Type: ?String; Readable: true; Writable: false

#### let to

```cangjie
public let to: Int32
```
功能： 目的移动位置。
Type: Int32; Readable: true; Writable: false


### DataReloadOperation

class DataReloadOperation
```cangjie
public class DataReloadOperation <: DataOperation { public DataReloadOperation() }
```
功能： 重载所有数据操作。当onDatasetChange含有DataReloadOperation操作时，其余操作全部失效，框架会自己调用keygenerator进行键值比对。


### ExchangeKey

class ExchangeKey
```cangjie
public class ExchangeKey { public ExchangeKey(public let start!: String = "", public let end!: String = "") }
```
功能： 键值。

#### let start

```cangjie
public let start: String = ""
```
功能： 为第一个交换的位置分配新的键值，默认使用原键值。
Type: String; Readable: true; Writable: false

#### let end

```cangjie
public let end: String = ""
```
功能： 为第二个交换的位置分配新的键值，默认使用原键值。
Type: String; Readable: true; Writable: false



## Examples

```cangjie
package ohos_app_cangjie_entry
import kit.UIKit.*
import ohos.state_macro_manage.*
import std.collection.*

public class Student {
 public Student(
 let name: String,
 let id: Int64
 ) {}
}

class StudentDataSource <: IDataSource<Student> {
 public StudentDataSource(let data_: ArrayList<Student>) {}
 public var listenerOp: Option<DataChangeListener> = None
 public func totalCount(): Int64 {
 return data_.size
 }
 public func getData(index: Int64): Student {
 return data_[index]
 }

 public func onRegisterDataChangeListener(listener: DataChangeListener): Unit {
 listenerOp = listener
 }

 public func onUnregisterDataChangeListener(listener: DataChangeListener): Unit {
 listenerOp = None
 }

 public func notifyChange(): Unit {
 let listener: DataChangeListener = listenerOp.getOrThrow()
 listener.onDataReloaded()
 }
}

func getDS(): StudentDataSource
{
 let data: ArrayList<Student> = ArrayList<Student>()
 for (i in 0..10) {
 data.add(Student("name ${i}", i * i))
 }
 let dataSourceStu: StudentDataSource = StudentDataSource(data)
 return dataSourceStu
}

let dataSourceStu: StudentDataSource = getDS()
var changeID: Int64 = 0

@Entry
@Component
public class EntryView {

 public func build(): Unit {
 Column(30) {
 Column {
 LazyForEach(dataSourceStu, itemGeneratorFunc: {stu: Student, idx: Int64 =>
 Column {
 Text(stu.name)
 }
 })
 }
 .height(220.0)

 Text("click to notifyChange").onClick({ evt =>
 if (changeID < dataSourceStu.data_.size) {
 dataSourceStu.data_.remove(at: changeID)
 dataSourceStu.data_.add(Student("xiaoming", 10086), at: changeID)
 dataSourceStu.notifyChange()
 changeID += 1
 }
 })
 }
 }
}
```

